{
  "content_type": "text/javascript",
  "base64content": "LyohCiAqIEJvb3RzdHJhcCB2My4yLjAgKGh0dHA6Ly9nZXRib290c3RyYXAuY29tKQogKiBDb3B5\ncmlnaHQgMjAxMS0yMDE0IFR3aXR0ZXIsIEluYy4KICogTGljZW5zZWQgdW5kZXIgTUlUIChodHRw\nczovL2dpdGh1Yi5jb20vdHdicy9ib290c3RyYXAvYmxvYi9tYXN0ZXIvTElDRU5TRSkKICovCgpp\nZiAodHlwZW9mIGpRdWVyeSA9PT0gJ3VuZGVmaW5lZCcpIHsgdGhyb3cgbmV3IEVycm9yKCdCb290\nc3RyYXBcJ3MgSmF2YVNjcmlwdCByZXF1aXJlcyBqUXVlcnknKSB9CgovKiA9PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT0KICogQm9vdHN0cmFwOiB0cmFuc2l0aW9uLmpzIHYzLjIuMAogKiBodHRwOi8vZ2V0Ym9vdHN0\ncmFwLmNvbS9qYXZhc2NyaXB0LyN0cmFuc2l0aW9ucwogKiA9PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICogQ29w\neXJpZ2h0IDIwMTEtMjAxNCBUd2l0dGVyLCBJbmMuCiAqIExpY2Vuc2VkIHVuZGVyIE1JVCAoaHR0\ncHM6Ly9naXRodWIuY29tL3R3YnMvYm9vdHN0cmFwL2Jsb2IvbWFzdGVyL0xJQ0VOU0UpCiAqID09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PSAqLwoKCitmdW5jdGlvbiAoJCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLy8g\nQ1NTIFRSQU5TSVRJT04gU1VQUE9SVCAoU2hvdXRvdXQ6IGh0dHA6Ly93d3cubW9kZXJuaXpyLmNv\nbS8pCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09CgogIGZ1bmN0aW9uIHRyYW5zaXRpb25FbmQoKSB7CiAgICB2YXIgZWwgPSBk\nb2N1bWVudC5jcmVhdGVFbGVtZW50KCdib290c3RyYXAnKQoKICAgIHZhciB0cmFuc0VuZEV2ZW50\nTmFtZXMgPSB7CiAgICAgIFdlYmtpdFRyYW5zaXRpb24gOiAnd2Via2l0VHJhbnNpdGlvbkVuZCcs\nCiAgICAgIE1velRyYW5zaXRpb24gICAgOiAndHJhbnNpdGlvbmVuZCcsCiAgICAgIE9UcmFuc2l0\naW9uICAgICAgOiAnb1RyYW5zaXRpb25FbmQgb3RyYW5zaXRpb25lbmQnLAogICAgICB0cmFuc2l0\naW9uICAgICAgIDogJ3RyYW5zaXRpb25lbmQnCiAgICB9CgogICAgZm9yICh2YXIgbmFtZSBpbiB0\ncmFuc0VuZEV2ZW50TmFtZXMpIHsKICAgICAgaWYgKGVsLnN0eWxlW25hbWVdICE9PSB1bmRlZmlu\nZWQpIHsKICAgICAgICByZXR1cm4geyBlbmQ6IHRyYW5zRW5kRXZlbnROYW1lc1tuYW1lXSB9CiAg\nICAgIH0KICAgIH0KCiAgICByZXR1cm4gZmFsc2UgLy8gZXhwbGljaXQgZm9yIGllOCAoICAuXy4p\nCiAgfQoKICAvLyBodHRwOi8vYmxvZy5hbGV4bWFjY2F3LmNvbS9jc3MtdHJhbnNpdGlvbnMKICAk\nLmZuLmVtdWxhdGVUcmFuc2l0aW9uRW5kID0gZnVuY3Rpb24gKGR1cmF0aW9uKSB7CiAgICB2YXIg\nY2FsbGVkID0gZmFsc2UKICAgIHZhciAkZWwgPSB0aGlzCiAgICAkKHRoaXMpLm9uZSgnYnNUcmFu\nc2l0aW9uRW5kJywgZnVuY3Rpb24gKCkgeyBjYWxsZWQgPSB0cnVlIH0pCiAgICB2YXIgY2FsbGJh\nY2sgPSBmdW5jdGlvbiAoKSB7IGlmICghY2FsbGVkKSAkKCRlbCkudHJpZ2dlcigkLnN1cHBvcnQu\ndHJhbnNpdGlvbi5lbmQpIH0KICAgIHNldFRpbWVvdXQoY2FsbGJhY2ssIGR1cmF0aW9uKQogICAg\ncmV0dXJuIHRoaXMKICB9CgogICQoZnVuY3Rpb24gKCkgewogICAgJC5zdXBwb3J0LnRyYW5zaXRp\nb24gPSB0cmFuc2l0aW9uRW5kKCkKCiAgICBpZiAoISQuc3VwcG9ydC50cmFuc2l0aW9uKSByZXR1\ncm4KCiAgICAkLmV2ZW50LnNwZWNpYWwuYnNUcmFuc2l0aW9uRW5kID0gewogICAgICBiaW5kVHlw\nZTogJC5zdXBwb3J0LnRyYW5zaXRpb24uZW5kLAogICAgICBkZWxlZ2F0ZVR5cGU6ICQuc3VwcG9y\ndC50cmFuc2l0aW9uLmVuZCwKICAgICAgaGFuZGxlOiBmdW5jdGlvbiAoZSkgewogICAgICAgIGlm\nICgkKGUudGFyZ2V0KS5pcyh0aGlzKSkgcmV0dXJuIGUuaGFuZGxlT2JqLmhhbmRsZXIuYXBwbHko\ndGhpcywgYXJndW1lbnRzKQogICAgICB9CiAgICB9CiAgfSkKCn0oalF1ZXJ5KTsKCi8qID09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PQogKiBCb290c3RyYXA6IGFsZXJ0LmpzIHYzLjIuMAogKiBodHRwOi8vZ2V0Ym9v\ndHN0cmFwLmNvbS9qYXZhc2NyaXB0LyNhbGVydHMKICogPT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAqIENvcHly\naWdodCAyMDExLTIwMTQgVHdpdHRlciwgSW5jLgogKiBMaWNlbnNlZCB1bmRlciBNSVQgKGh0dHBz\nOi8vZ2l0aHViLmNvbS90d2JzL2Jvb3RzdHJhcC9ibG9iL21hc3Rlci9MSUNFTlNFKQogKiA9PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT0gKi8KCgorZnVuY3Rpb24gKCQpIHsKICAndXNlIHN0cmljdCc7CgogIC8vIEFM\nRVJUIENMQVNTIERFRklOSVRJT04KICAvLyA9PT09PT09PT09PT09PT09PT09PT09CgogIHZhciBk\naXNtaXNzID0gJ1tkYXRhLWRpc21pc3M9ImFsZXJ0Il0nCiAgdmFyIEFsZXJ0ICAgPSBmdW5jdGlv\nbiAoZWwpIHsKICAgICQoZWwpLm9uKCdjbGljaycsIGRpc21pc3MsIHRoaXMuY2xvc2UpCiAgfQoK\nICBBbGVydC5WRVJTSU9OID0gJzMuMi4wJwoKICBBbGVydC5wcm90b3R5cGUuY2xvc2UgPSBmdW5j\ndGlvbiAoZSkgewogICAgdmFyICR0aGlzICAgID0gJCh0aGlzKQogICAgdmFyIHNlbGVjdG9yID0g\nJHRoaXMuYXR0cignZGF0YS10YXJnZXQnKQoKICAgIGlmICghc2VsZWN0b3IpIHsKICAgICAgc2Vs\nZWN0b3IgPSAkdGhpcy5hdHRyKCdocmVmJykKICAgICAgc2VsZWN0b3IgPSBzZWxlY3RvciAmJiBz\nZWxlY3Rvci5yZXBsYWNlKC8uKig/PSNbXlxzXSokKS8sICcnKSAvLyBzdHJpcCBmb3IgaWU3CiAg\nICB9CgogICAgdmFyICRwYXJlbnQgPSAkKHNlbGVjdG9yKQoKICAgIGlmIChlKSBlLnByZXZlbnRE\nZWZhdWx0KCkKCiAgICBpZiAoISRwYXJlbnQubGVuZ3RoKSB7CiAgICAgICRwYXJlbnQgPSAkdGhp\ncy5oYXNDbGFzcygnYWxlcnQnKSA/ICR0aGlzIDogJHRoaXMucGFyZW50KCkKICAgIH0KCiAgICAk\ncGFyZW50LnRyaWdnZXIoZSA9ICQuRXZlbnQoJ2Nsb3NlLmJzLmFsZXJ0JykpCgogICAgaWYgKGUu\naXNEZWZhdWx0UHJldmVudGVkKCkpIHJldHVybgoKICAgICRwYXJlbnQucmVtb3ZlQ2xhc3MoJ2lu\nJykKCiAgICBmdW5jdGlvbiByZW1vdmVFbGVtZW50KCkgewogICAgICAvLyBkZXRhY2ggZnJvbSBw\nYXJlbnQsIGZpcmUgZXZlbnQgdGhlbiBjbGVhbiB1cCBkYXRhCiAgICAgICRwYXJlbnQuZGV0YWNo\nKCkudHJpZ2dlcignY2xvc2VkLmJzLmFsZXJ0JykucmVtb3ZlKCkKICAgIH0KCiAgICAkLnN1cHBv\ncnQudHJhbnNpdGlvbiAmJiAkcGFyZW50Lmhhc0NsYXNzKCdmYWRlJykgPwogICAgICAkcGFyZW50\nCiAgICAgICAgLm9uZSgnYnNUcmFuc2l0aW9uRW5kJywgcmVtb3ZlRWxlbWVudCkKICAgICAgICAu\nZW11bGF0ZVRyYW5zaXRpb25FbmQoMTUwKSA6CiAgICAgIHJlbW92ZUVsZW1lbnQoKQogIH0KCgog\nIC8vIEFMRVJUIFBMVUdJTiBERUZJTklUSU9OCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT0K\nCiAgZnVuY3Rpb24gUGx1Z2luKG9wdGlvbikgewogICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlv\nbiAoKSB7CiAgICAgIHZhciAkdGhpcyA9ICQodGhpcykKICAgICAgdmFyIGRhdGEgID0gJHRoaXMu\nZGF0YSgnYnMuYWxlcnQnKQoKICAgICAgaWYgKCFkYXRhKSAkdGhpcy5kYXRhKCdicy5hbGVydCcs\nIChkYXRhID0gbmV3IEFsZXJ0KHRoaXMpKSkKICAgICAgaWYgKHR5cGVvZiBvcHRpb24gPT0gJ3N0\ncmluZycpIGRhdGFbb3B0aW9uXS5jYWxsKCR0aGlzKQogICAgfSkKICB9CgogIHZhciBvbGQgPSAk\nLmZuLmFsZXJ0CgogICQuZm4uYWxlcnQgICAgICAgICAgICAgPSBQbHVnaW4KICAkLmZuLmFsZXJ0\nLkNvbnN0cnVjdG9yID0gQWxlcnQKCgogIC8vIEFMRVJUIE5PIENPTkZMSUNUCiAgLy8gPT09PT09\nPT09PT09PT09PT0KCiAgJC5mbi5hbGVydC5ub0NvbmZsaWN0ID0gZnVuY3Rpb24gKCkgewogICAg\nJC5mbi5hbGVydCA9IG9sZAogICAgcmV0dXJuIHRoaXMKICB9CgoKICAvLyBBTEVSVCBEQVRBLUFQ\nSQogIC8vID09PT09PT09PT09PT09CgogICQoZG9jdW1lbnQpLm9uKCdjbGljay5icy5hbGVydC5k\nYXRhLWFwaScsIGRpc21pc3MsIEFsZXJ0LnByb3RvdHlwZS5jbG9zZSkKCn0oalF1ZXJ5KTsKCi8q\nID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PQogKiBCb290c3RyYXA6IGJ1dHRvbi5qcyB2My4yLjAKICogaHR0cDov\nL2dldGJvb3RzdHJhcC5jb20vamF2YXNjcmlwdC8jYnV0dG9ucwogKiA9PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0K\nICogQ29weXJpZ2h0IDIwMTEtMjAxNCBUd2l0dGVyLCBJbmMuCiAqIExpY2Vuc2VkIHVuZGVyIE1J\nVCAoaHR0cHM6Ly9naXRodWIuY29tL3R3YnMvYm9vdHN0cmFwL2Jsb2IvbWFzdGVyL0xJQ0VOU0Up\nCiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PSAqLwoKCitmdW5jdGlvbiAoJCkgewogICd1c2Ugc3RyaWN0JzsK\nCiAgLy8gQlVUVE9OIFBVQkxJQyBDTEFTUyBERUZJTklUSU9OCiAgLy8gPT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09CgogIHZhciBCdXR0b24gPSBmdW5jdGlvbiAoZWxlbWVudCwgb3B0aW9u\ncykgewogICAgdGhpcy4kZWxlbWVudCAgPSAkKGVsZW1lbnQpCiAgICB0aGlzLm9wdGlvbnMgICA9\nICQuZXh0ZW5kKHt9LCBCdXR0b24uREVGQVVMVFMsIG9wdGlvbnMpCiAgICB0aGlzLmlzTG9hZGlu\nZyA9IGZhbHNlCiAgfQoKICBCdXR0b24uVkVSU0lPTiAgPSAnMy4yLjAnCgogIEJ1dHRvbi5ERUZB\nVUxUUyA9IHsKICAgIGxvYWRpbmdUZXh0OiAnbG9hZGluZy4uLicKICB9CgogIEJ1dHRvbi5wcm90\nb3R5cGUuc2V0U3RhdGUgPSBmdW5jdGlvbiAoc3RhdGUpIHsKICAgIHZhciBkICAgID0gJ2Rpc2Fi\nbGVkJwogICAgdmFyICRlbCAgPSB0aGlzLiRlbGVtZW50CiAgICB2YXIgdmFsICA9ICRlbC5pcygn\naW5wdXQnKSA/ICd2YWwnIDogJ2h0bWwnCiAgICB2YXIgZGF0YSA9ICRlbC5kYXRhKCkKCiAgICBz\ndGF0ZSA9IHN0YXRlICsgJ1RleHQnCgogICAgaWYgKGRhdGEucmVzZXRUZXh0ID09IG51bGwpICRl\nbC5kYXRhKCdyZXNldFRleHQnLCAkZWxbdmFsXSgpKQoKICAgICRlbFt2YWxdKGRhdGFbc3RhdGVd\nID09IG51bGwgPyB0aGlzLm9wdGlvbnNbc3RhdGVdIDogZGF0YVtzdGF0ZV0pCgogICAgLy8gcHVz\naCB0byBldmVudCBsb29wIHRvIGFsbG93IGZvcm1zIHRvIHN1Ym1pdAogICAgc2V0VGltZW91dCgk\nLnByb3h5KGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKHN0YXRlID09ICdsb2FkaW5nVGV4dCcpIHsK\nICAgICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWUKICAgICAgICAkZWwuYWRkQ2xhc3MoZCkuYXR0\ncihkLCBkKQogICAgICB9IGVsc2UgaWYgKHRoaXMuaXNMb2FkaW5nKSB7CiAgICAgICAgdGhpcy5p\nc0xvYWRpbmcgPSBmYWxzZQogICAgICAgICRlbC5yZW1vdmVDbGFzcyhkKS5yZW1vdmVBdHRyKGQp\nCiAgICAgIH0KICAgIH0sIHRoaXMpLCAwKQogIH0KCiAgQnV0dG9uLnByb3RvdHlwZS50b2dnbGUg\nPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgY2hhbmdlZCA9IHRydWUKICAgIHZhciAkcGFyZW50ID0g\ndGhpcy4kZWxlbWVudC5jbG9zZXN0KCdbZGF0YS10b2dnbGU9ImJ1dHRvbnMiXScpCgogICAgaWYg\nKCRwYXJlbnQubGVuZ3RoKSB7CiAgICAgIHZhciAkaW5wdXQgPSB0aGlzLiRlbGVtZW50LmZpbmQo\nJ2lucHV0JykKICAgICAgaWYgKCRpbnB1dC5wcm9wKCd0eXBlJykgPT0gJ3JhZGlvJykgewogICAg\nICAgIGlmICgkaW5wdXQucHJvcCgnY2hlY2tlZCcpICYmIHRoaXMuJGVsZW1lbnQuaGFzQ2xhc3Mo\nJ2FjdGl2ZScpKSBjaGFuZ2VkID0gZmFsc2UKICAgICAgICBlbHNlICRwYXJlbnQuZmluZCgnLmFj\ndGl2ZScpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKQogICAgICB9CiAgICAgIGlmIChjaGFuZ2VkKSAk\naW5wdXQucHJvcCgnY2hlY2tlZCcsICF0aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCdhY3RpdmUnKSku\ndHJpZ2dlcignY2hhbmdlJykKICAgIH0KCiAgICBpZiAoY2hhbmdlZCkgdGhpcy4kZWxlbWVudC50\nb2dnbGVDbGFzcygnYWN0aXZlJykKICB9CgoKICAvLyBCVVRUT04gUExVR0lOIERFRklOSVRJT04K\nICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT0KCiAgZnVuY3Rpb24gUGx1Z2luKG9wdGlvbikg\newogICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgIHZhciAkdGhpcyAgID0g\nJCh0aGlzKQogICAgICB2YXIgZGF0YSAgICA9ICR0aGlzLmRhdGEoJ2JzLmJ1dHRvbicpCiAgICAg\nIHZhciBvcHRpb25zID0gdHlwZW9mIG9wdGlvbiA9PSAnb2JqZWN0JyAmJiBvcHRpb24KCiAgICAg\nIGlmICghZGF0YSkgJHRoaXMuZGF0YSgnYnMuYnV0dG9uJywgKGRhdGEgPSBuZXcgQnV0dG9uKHRo\naXMsIG9wdGlvbnMpKSkKCiAgICAgIGlmIChvcHRpb24gPT0gJ3RvZ2dsZScpIGRhdGEudG9nZ2xl\nKCkKICAgICAgZWxzZSBpZiAob3B0aW9uKSBkYXRhLnNldFN0YXRlKG9wdGlvbikKICAgIH0pCiAg\nfQoKICB2YXIgb2xkID0gJC5mbi5idXR0b24KCiAgJC5mbi5idXR0b24gICAgICAgICAgICAgPSBQ\nbHVnaW4KICAkLmZuLmJ1dHRvbi5Db25zdHJ1Y3RvciA9IEJ1dHRvbgoKCiAgLy8gQlVUVE9OIE5P\nIENPTkZMSUNUCiAgLy8gPT09PT09PT09PT09PT09PT09CgogICQuZm4uYnV0dG9uLm5vQ29uZmxp\nY3QgPSBmdW5jdGlvbiAoKSB7CiAgICAkLmZuLmJ1dHRvbiA9IG9sZAogICAgcmV0dXJuIHRoaXMK\nICB9CgoKICAvLyBCVVRUT04gREFUQS1BUEkKICAvLyA9PT09PT09PT09PT09PT0KCiAgJChkb2N1\nbWVudCkub24oJ2NsaWNrLmJzLmJ1dHRvbi5kYXRhLWFwaScsICdbZGF0YS10b2dnbGVePSJidXR0\nb24iXScsIGZ1bmN0aW9uIChlKSB7CiAgICB2YXIgJGJ0biA9ICQoZS50YXJnZXQpCiAgICBpZiAo\nISRidG4uaGFzQ2xhc3MoJ2J0bicpKSAkYnRuID0gJGJ0bi5jbG9zZXN0KCcuYnRuJykKICAgIFBs\ndWdpbi5jYWxsKCRidG4sICd0b2dnbGUnKQogICAgZS5wcmV2ZW50RGVmYXVsdCgpCiAgfSkKCn0o\nalF1ZXJ5KTsKCi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PQogKiBCb290c3RyYXA6IGNhcm91c2VsLmpzIHYz\nLjIuMAogKiBodHRwOi8vZ2V0Ym9vdHN0cmFwLmNvbS9qYXZhc2NyaXB0LyNjYXJvdXNlbAogKiA9\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT0KICogQ29weXJpZ2h0IDIwMTEtMjAxNCBUd2l0dGVyLCBJbmMuCiAqIExp\nY2Vuc2VkIHVuZGVyIE1JVCAoaHR0cHM6Ly9naXRodWIuY29tL3R3YnMvYm9vdHN0cmFwL2Jsb2Iv\nbWFzdGVyL0xJQ0VOU0UpCiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwoKCitmdW5jdGlvbiAoJCkgewog\nICd1c2Ugc3RyaWN0JzsKCiAgLy8gQ0FST1VTRUwgQ0xBU1MgREVGSU5JVElPTgogIC8vID09PT09\nPT09PT09PT09PT09PT09PT09PT0KCiAgdmFyIENhcm91c2VsID0gZnVuY3Rpb24gKGVsZW1lbnQs\nIG9wdGlvbnMpIHsKICAgIHRoaXMuJGVsZW1lbnQgICAgPSAkKGVsZW1lbnQpLm9uKCdrZXlkb3du\nLmJzLmNhcm91c2VsJywgJC5wcm94eSh0aGlzLmtleWRvd24sIHRoaXMpKQogICAgdGhpcy4kaW5k\naWNhdG9ycyA9IHRoaXMuJGVsZW1lbnQuZmluZCgnLmNhcm91c2VsLWluZGljYXRvcnMnKQogICAg\ndGhpcy5vcHRpb25zICAgICA9IG9wdGlvbnMKICAgIHRoaXMucGF1c2VkICAgICAgPQogICAgdGhp\ncy5zbGlkaW5nICAgICA9CiAgICB0aGlzLmludGVydmFsICAgID0KICAgIHRoaXMuJGFjdGl2ZSAg\nICAgPQogICAgdGhpcy4kaXRlbXMgICAgICA9IG51bGwKCiAgICB0aGlzLm9wdGlvbnMucGF1c2Ug\nPT0gJ2hvdmVyJyAmJiB0aGlzLiRlbGVtZW50CiAgICAgIC5vbignbW91c2VlbnRlci5icy5jYXJv\ndXNlbCcsICQucHJveHkodGhpcy5wYXVzZSwgdGhpcykpCiAgICAgIC5vbignbW91c2VsZWF2ZS5i\ncy5jYXJvdXNlbCcsICQucHJveHkodGhpcy5jeWNsZSwgdGhpcykpCiAgfQoKICBDYXJvdXNlbC5W\nRVJTSU9OICA9ICczLjIuMCcKCiAgQ2Fyb3VzZWwuREVGQVVMVFMgPSB7CiAgICBpbnRlcnZhbDog\nNTAwMCwKICAgIHBhdXNlOiAnaG92ZXInLAogICAgd3JhcDogdHJ1ZQogIH0KCiAgQ2Fyb3VzZWwu\ncHJvdG90eXBlLmtleWRvd24gPSBmdW5jdGlvbiAoZSkgewogICAgc3dpdGNoIChlLndoaWNoKSB7\nCiAgICAgIGNhc2UgMzc6IHRoaXMucHJldigpOyBicmVhawogICAgICBjYXNlIDM5OiB0aGlzLm5l\neHQoKTsgYnJlYWsKICAgICAgZGVmYXVsdDogcmV0dXJuCiAgICB9CgogICAgZS5wcmV2ZW50RGVm\nYXVsdCgpCiAgfQoKICBDYXJvdXNlbC5wcm90b3R5cGUuY3ljbGUgPSBmdW5jdGlvbiAoZSkgewog\nICAgZSB8fCAodGhpcy5wYXVzZWQgPSBmYWxzZSkKCiAgICB0aGlzLmludGVydmFsICYmIGNsZWFy\nSW50ZXJ2YWwodGhpcy5pbnRlcnZhbCkKCiAgICB0aGlzLm9wdGlvbnMuaW50ZXJ2YWwKICAgICAg\nJiYgIXRoaXMucGF1c2VkCiAgICAgICYmICh0aGlzLmludGVydmFsID0gc2V0SW50ZXJ2YWwoJC5w\ncm94eSh0aGlzLm5leHQsIHRoaXMpLCB0aGlzLm9wdGlvbnMuaW50ZXJ2YWwpKQoKICAgIHJldHVy\nbiB0aGlzCiAgfQoKICBDYXJvdXNlbC5wcm90b3R5cGUuZ2V0SXRlbUluZGV4ID0gZnVuY3Rpb24g\nKGl0ZW0pIHsKICAgIHRoaXMuJGl0ZW1zID0gaXRlbS5wYXJlbnQoKS5jaGlsZHJlbignLml0ZW0n\nKQogICAgcmV0dXJuIHRoaXMuJGl0ZW1zLmluZGV4KGl0ZW0gfHwgdGhpcy4kYWN0aXZlKQogIH0K\nCiAgQ2Fyb3VzZWwucHJvdG90eXBlLnRvID0gZnVuY3Rpb24gKHBvcykgewogICAgdmFyIHRoYXQg\nICAgICAgID0gdGhpcwogICAgdmFyIGFjdGl2ZUluZGV4ID0gdGhpcy5nZXRJdGVtSW5kZXgodGhp\ncy4kYWN0aXZlID0gdGhpcy4kZWxlbWVudC5maW5kKCcuaXRlbS5hY3RpdmUnKSkKCiAgICBpZiAo\ncG9zID4gKHRoaXMuJGl0ZW1zLmxlbmd0aCAtIDEpIHx8IHBvcyA8IDApIHJldHVybgoKICAgIGlm\nICh0aGlzLnNsaWRpbmcpICAgICAgIHJldHVybiB0aGlzLiRlbGVtZW50Lm9uZSgnc2xpZC5icy5j\nYXJvdXNlbCcsIGZ1bmN0aW9uICgpIHsgdGhhdC50byhwb3MpIH0pIC8vIHllcywgInNsaWQiCiAg\nICBpZiAoYWN0aXZlSW5kZXggPT0gcG9zKSByZXR1cm4gdGhpcy5wYXVzZSgpLmN5Y2xlKCkKCiAg\nICByZXR1cm4gdGhpcy5zbGlkZShwb3MgPiBhY3RpdmVJbmRleCA/ICduZXh0JyA6ICdwcmV2Jywg\nJCh0aGlzLiRpdGVtc1twb3NdKSkKICB9CgogIENhcm91c2VsLnByb3RvdHlwZS5wYXVzZSA9IGZ1\nbmN0aW9uIChlKSB7CiAgICBlIHx8ICh0aGlzLnBhdXNlZCA9IHRydWUpCgogICAgaWYgKHRoaXMu\nJGVsZW1lbnQuZmluZCgnLm5leHQsIC5wcmV2JykubGVuZ3RoICYmICQuc3VwcG9ydC50cmFuc2l0\naW9uKSB7CiAgICAgIHRoaXMuJGVsZW1lbnQudHJpZ2dlcigkLnN1cHBvcnQudHJhbnNpdGlvbi5l\nbmQpCiAgICAgIHRoaXMuY3ljbGUodHJ1ZSkKICAgIH0KCiAgICB0aGlzLmludGVydmFsID0gY2xl\nYXJJbnRlcnZhbCh0aGlzLmludGVydmFsKQoKICAgIHJldHVybiB0aGlzCiAgfQoKICBDYXJvdXNl\nbC5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICgpIHsKICAgIGlmICh0aGlzLnNsaWRpbmcpIHJl\ndHVybgogICAgcmV0dXJuIHRoaXMuc2xpZGUoJ25leHQnKQogIH0KCiAgQ2Fyb3VzZWwucHJvdG90\neXBlLnByZXYgPSBmdW5jdGlvbiAoKSB7CiAgICBpZiAodGhpcy5zbGlkaW5nKSByZXR1cm4KICAg\nIHJldHVybiB0aGlzLnNsaWRlKCdwcmV2JykKICB9CgogIENhcm91c2VsLnByb3RvdHlwZS5zbGlk\nZSA9IGZ1bmN0aW9uICh0eXBlLCBuZXh0KSB7CiAgICB2YXIgJGFjdGl2ZSAgID0gdGhpcy4kZWxl\nbWVudC5maW5kKCcuaXRlbS5hY3RpdmUnKQogICAgdmFyICRuZXh0ICAgICA9IG5leHQgfHwgJGFj\ndGl2ZVt0eXBlXSgpCiAgICB2YXIgaXNDeWNsaW5nID0gdGhpcy5pbnRlcnZhbAogICAgdmFyIGRp\ncmVjdGlvbiA9IHR5cGUgPT0gJ25leHQnID8gJ2xlZnQnIDogJ3JpZ2h0JwogICAgdmFyIGZhbGxi\nYWNrICA9IHR5cGUgPT0gJ25leHQnID8gJ2ZpcnN0JyA6ICdsYXN0JwogICAgdmFyIHRoYXQgICAg\nICA9IHRoaXMKCiAgICBpZiAoISRuZXh0Lmxlbmd0aCkgewogICAgICBpZiAoIXRoaXMub3B0aW9u\ncy53cmFwKSByZXR1cm4KICAgICAgJG5leHQgPSB0aGlzLiRlbGVtZW50LmZpbmQoJy5pdGVtJylb\nZmFsbGJhY2tdKCkKICAgIH0KCiAgICBpZiAoJG5leHQuaGFzQ2xhc3MoJ2FjdGl2ZScpKSByZXR1\ncm4gKHRoaXMuc2xpZGluZyA9IGZhbHNlKQoKICAgIHZhciByZWxhdGVkVGFyZ2V0ID0gJG5leHRb\nMF0KICAgIHZhciBzbGlkZUV2ZW50ID0gJC5FdmVudCgnc2xpZGUuYnMuY2Fyb3VzZWwnLCB7CiAg\nICAgIHJlbGF0ZWRUYXJnZXQ6IHJlbGF0ZWRUYXJnZXQsCiAgICAgIGRpcmVjdGlvbjogZGlyZWN0\naW9uCiAgICB9KQogICAgdGhpcy4kZWxlbWVudC50cmlnZ2VyKHNsaWRlRXZlbnQpCiAgICBpZiAo\nc2xpZGVFdmVudC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgcmV0dXJuCgogICAgdGhpcy5zbGlkaW5n\nID0gdHJ1ZQoKICAgIGlzQ3ljbGluZyAmJiB0aGlzLnBhdXNlKCkKCiAgICBpZiAodGhpcy4kaW5k\naWNhdG9ycy5sZW5ndGgpIHsKICAgICAgdGhpcy4kaW5kaWNhdG9ycy5maW5kKCcuYWN0aXZlJyku\ncmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpCiAgICAgIHZhciAkbmV4dEluZGljYXRvciA9ICQodGhpcy4k\naW5kaWNhdG9ycy5jaGlsZHJlbigpW3RoaXMuZ2V0SXRlbUluZGV4KCRuZXh0KV0pCiAgICAgICRu\nZXh0SW5kaWNhdG9yICYmICRuZXh0SW5kaWNhdG9yLmFkZENsYXNzKCdhY3RpdmUnKQogICAgfQoK\nICAgIHZhciBzbGlkRXZlbnQgPSAkLkV2ZW50KCdzbGlkLmJzLmNhcm91c2VsJywgeyByZWxhdGVk\nVGFyZ2V0OiByZWxhdGVkVGFyZ2V0LCBkaXJlY3Rpb246IGRpcmVjdGlvbiB9KSAvLyB5ZXMsICJz\nbGlkIgogICAgaWYgKCQuc3VwcG9ydC50cmFuc2l0aW9uICYmIHRoaXMuJGVsZW1lbnQuaGFzQ2xh\nc3MoJ3NsaWRlJykpIHsKICAgICAgJG5leHQuYWRkQ2xhc3ModHlwZSkKICAgICAgJG5leHRbMF0u\nb2Zmc2V0V2lkdGggLy8gZm9yY2UgcmVmbG93CiAgICAgICRhY3RpdmUuYWRkQ2xhc3MoZGlyZWN0\naW9uKQogICAgICAkbmV4dC5hZGRDbGFzcyhkaXJlY3Rpb24pCiAgICAgICRhY3RpdmUKICAgICAg\nICAub25lKCdic1RyYW5zaXRpb25FbmQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAkbmV4dC5y\nZW1vdmVDbGFzcyhbdHlwZSwgZGlyZWN0aW9uXS5qb2luKCcgJykpLmFkZENsYXNzKCdhY3RpdmUn\nKQogICAgICAgICAgJGFjdGl2ZS5yZW1vdmVDbGFzcyhbJ2FjdGl2ZScsIGRpcmVjdGlvbl0uam9p\nbignICcpKQogICAgICAgICAgdGhhdC5zbGlkaW5nID0gZmFsc2UKICAgICAgICAgIHNldFRpbWVv\ndXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICB0aGF0LiRlbGVtZW50LnRyaWdnZXIoc2xpZEV2\nZW50KQogICAgICAgICAgfSwgMCkKICAgICAgICB9KQogICAgICAgIC5lbXVsYXRlVHJhbnNpdGlv\nbkVuZCgkYWN0aXZlLmNzcygndHJhbnNpdGlvbi1kdXJhdGlvbicpLnNsaWNlKDAsIC0xKSAqIDEw\nMDApCiAgICB9IGVsc2UgewogICAgICAkYWN0aXZlLnJlbW92ZUNsYXNzKCdhY3RpdmUnKQogICAg\nICAkbmV4dC5hZGRDbGFzcygnYWN0aXZlJykKICAgICAgdGhpcy5zbGlkaW5nID0gZmFsc2UKICAg\nICAgdGhpcy4kZWxlbWVudC50cmlnZ2VyKHNsaWRFdmVudCkKICAgIH0KCiAgICBpc0N5Y2xpbmcg\nJiYgdGhpcy5jeWNsZSgpCgogICAgcmV0dXJuIHRoaXMKICB9CgoKICAvLyBDQVJPVVNFTCBQTFVH\nSU4gREVGSU5JVElPTgogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09CgogIGZ1bmN0aW9u\nIFBsdWdpbihvcHRpb24pIHsKICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgewogICAg\nICB2YXIgJHRoaXMgICA9ICQodGhpcykKICAgICAgdmFyIGRhdGEgICAgPSAkdGhpcy5kYXRhKCdi\ncy5jYXJvdXNlbCcpCiAgICAgIHZhciBvcHRpb25zID0gJC5leHRlbmQoe30sIENhcm91c2VsLkRF\nRkFVTFRTLCAkdGhpcy5kYXRhKCksIHR5cGVvZiBvcHRpb24gPT0gJ29iamVjdCcgJiYgb3B0aW9u\nKQogICAgICB2YXIgYWN0aW9uICA9IHR5cGVvZiBvcHRpb24gPT0gJ3N0cmluZycgPyBvcHRpb24g\nOiBvcHRpb25zLnNsaWRlCgogICAgICBpZiAoIWRhdGEpICR0aGlzLmRhdGEoJ2JzLmNhcm91c2Vs\nJywgKGRhdGEgPSBuZXcgQ2Fyb3VzZWwodGhpcywgb3B0aW9ucykpKQogICAgICBpZiAodHlwZW9m\nIG9wdGlvbiA9PSAnbnVtYmVyJykgZGF0YS50byhvcHRpb24pCiAgICAgIGVsc2UgaWYgKGFjdGlv\nbikgZGF0YVthY3Rpb25dKCkKICAgICAgZWxzZSBpZiAob3B0aW9ucy5pbnRlcnZhbCkgZGF0YS5w\nYXVzZSgpLmN5Y2xlKCkKICAgIH0pCiAgfQoKICB2YXIgb2xkID0gJC5mbi5jYXJvdXNlbAoKICAk\nLmZuLmNhcm91c2VsICAgICAgICAgICAgID0gUGx1Z2luCiAgJC5mbi5jYXJvdXNlbC5Db25zdHJ1\nY3RvciA9IENhcm91c2VsCgoKICAvLyBDQVJPVVNFTCBOTyBDT05GTElDVAogIC8vID09PT09PT09\nPT09PT09PT09PT09CgogICQuZm4uY2Fyb3VzZWwubm9Db25mbGljdCA9IGZ1bmN0aW9uICgpIHsK\nICAgICQuZm4uY2Fyb3VzZWwgPSBvbGQKICAgIHJldHVybiB0aGlzCiAgfQoKCiAgLy8gQ0FST1VT\nRUwgREFUQS1BUEkKICAvLyA9PT09PT09PT09PT09PT09PQoKICAkKGRvY3VtZW50KS5vbignY2xp\nY2suYnMuY2Fyb3VzZWwuZGF0YS1hcGknLCAnW2RhdGEtc2xpZGVdLCBbZGF0YS1zbGlkZS10b10n\nLCBmdW5jdGlvbiAoZSkgewogICAgdmFyIGhyZWYKICAgIHZhciAkdGhpcyAgID0gJCh0aGlzKQog\nICAgdmFyICR0YXJnZXQgPSAkKCR0aGlzLmF0dHIoJ2RhdGEtdGFyZ2V0JykgfHwgKGhyZWYgPSAk\ndGhpcy5hdHRyKCdocmVmJykpICYmIGhyZWYucmVwbGFjZSgvLiooPz0jW15cc10rJCkvLCAnJykp\nIC8vIHN0cmlwIGZvciBpZTcKICAgIGlmICghJHRhcmdldC5oYXNDbGFzcygnY2Fyb3VzZWwnKSkg\ncmV0dXJuCiAgICB2YXIgb3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCAkdGFyZ2V0LmRhdGEoKSwgJHRo\naXMuZGF0YSgpKQogICAgdmFyIHNsaWRlSW5kZXggPSAkdGhpcy5hdHRyKCdkYXRhLXNsaWRlLXRv\nJykKICAgIGlmIChzbGlkZUluZGV4KSBvcHRpb25zLmludGVydmFsID0gZmFsc2UKCiAgICBQbHVn\naW4uY2FsbCgkdGFyZ2V0LCBvcHRpb25zKQoKICAgIGlmIChzbGlkZUluZGV4KSB7CiAgICAgICR0\nYXJnZXQuZGF0YSgnYnMuY2Fyb3VzZWwnKS50byhzbGlkZUluZGV4KQogICAgfQoKICAgIGUucHJl\ndmVudERlZmF1bHQoKQogIH0pCgogICQod2luZG93KS5vbignbG9hZCcsIGZ1bmN0aW9uICgpIHsK\nICAgICQoJ1tkYXRhLXJpZGU9ImNhcm91c2VsIl0nKS5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAg\ndmFyICRjYXJvdXNlbCA9ICQodGhpcykKICAgICAgUGx1Z2luLmNhbGwoJGNhcm91c2VsLCAkY2Fy\nb3VzZWwuZGF0YSgpKQogICAgfSkKICB9KQoKfShqUXVlcnkpOwoKLyogPT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nCiAqIEJvb3RzdHJhcDogY29sbGFwc2UuanMgdjMuMi4wCiAqIGh0dHA6Ly9nZXRib290c3RyYXAu\nY29tL2phdmFzY3JpcHQvI2NvbGxhcHNlCiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogKiBDb3B5cmlnaHQg\nMjAxMS0yMDE0IFR3aXR0ZXIsIEluYy4KICogTGljZW5zZWQgdW5kZXIgTUlUIChodHRwczovL2dp\ndGh1Yi5jb20vdHdicy9ib290c3RyYXAvYmxvYi9tYXN0ZXIvTElDRU5TRSkKICogPT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09ICovCgoKK2Z1bmN0aW9uICgkKSB7CiAgJ3VzZSBzdHJpY3QnOwoKICAvLyBDT0xMQVBT\nRSBQVUJMSUMgQ0xBU1MgREVGSU5JVElPTgogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09CgogIHZhciBDb2xsYXBzZSA9IGZ1bmN0aW9uIChlbGVtZW50LCBvcHRpb25zKSB7CiAg\nICB0aGlzLiRlbGVtZW50ICAgICAgPSAkKGVsZW1lbnQpCiAgICB0aGlzLm9wdGlvbnMgICAgICAg\nPSAkLmV4dGVuZCh7fSwgQ29sbGFwc2UuREVGQVVMVFMsIG9wdGlvbnMpCiAgICB0aGlzLnRyYW5z\naXRpb25pbmcgPSBudWxsCgogICAgaWYgKHRoaXMub3B0aW9ucy5wYXJlbnQpIHRoaXMuJHBhcmVu\ndCA9ICQodGhpcy5vcHRpb25zLnBhcmVudCkKICAgIGlmICh0aGlzLm9wdGlvbnMudG9nZ2xlKSB0\naGlzLnRvZ2dsZSgpCiAgfQoKICBDb2xsYXBzZS5WRVJTSU9OICA9ICczLjIuMCcKCiAgQ29sbGFw\nc2UuREVGQVVMVFMgPSB7CiAgICB0b2dnbGU6IHRydWUKICB9CgogIENvbGxhcHNlLnByb3RvdHlw\nZS5kaW1lbnNpb24gPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgaGFzV2lkdGggPSB0aGlzLiRlbGVt\nZW50Lmhhc0NsYXNzKCd3aWR0aCcpCiAgICByZXR1cm4gaGFzV2lkdGggPyAnd2lkdGgnIDogJ2hl\naWdodCcKICB9CgogIENvbGxhcHNlLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24gKCkgewogICAg\naWYgKHRoaXMudHJhbnNpdGlvbmluZyB8fCB0aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCdpbicpKSBy\nZXR1cm4KCiAgICB2YXIgc3RhcnRFdmVudCA9ICQuRXZlbnQoJ3Nob3cuYnMuY29sbGFwc2UnKQog\nICAgdGhpcy4kZWxlbWVudC50cmlnZ2VyKHN0YXJ0RXZlbnQpCiAgICBpZiAoc3RhcnRFdmVudC5p\nc0RlZmF1bHRQcmV2ZW50ZWQoKSkgcmV0dXJuCgogICAgdmFyIGFjdGl2ZXMgPSB0aGlzLiRwYXJl\nbnQgJiYgdGhpcy4kcGFyZW50LmZpbmQoJz4gLnBhbmVsID4gLmluJykKCiAgICBpZiAoYWN0aXZl\ncyAmJiBhY3RpdmVzLmxlbmd0aCkgewogICAgICB2YXIgaGFzRGF0YSA9IGFjdGl2ZXMuZGF0YSgn\nYnMuY29sbGFwc2UnKQogICAgICBpZiAoaGFzRGF0YSAmJiBoYXNEYXRhLnRyYW5zaXRpb25pbmcp\nIHJldHVybgogICAgICBQbHVnaW4uY2FsbChhY3RpdmVzLCAnaGlkZScpCiAgICAgIGhhc0RhdGEg\nfHwgYWN0aXZlcy5kYXRhKCdicy5jb2xsYXBzZScsIG51bGwpCiAgICB9CgogICAgdmFyIGRpbWVu\nc2lvbiA9IHRoaXMuZGltZW5zaW9uKCkKCiAgICB0aGlzLiRlbGVtZW50CiAgICAgIC5yZW1vdmVD\nbGFzcygnY29sbGFwc2UnKQogICAgICAuYWRkQ2xhc3MoJ2NvbGxhcHNpbmcnKVtkaW1lbnNpb25d\nKDApCgogICAgdGhpcy50cmFuc2l0aW9uaW5nID0gMQoKICAgIHZhciBjb21wbGV0ZSA9IGZ1bmN0\naW9uICgpIHsKICAgICAgdGhpcy4kZWxlbWVudAogICAgICAgIC5yZW1vdmVDbGFzcygnY29sbGFw\nc2luZycpCiAgICAgICAgLmFkZENsYXNzKCdjb2xsYXBzZSBpbicpW2RpbWVuc2lvbl0oJycpCiAg\nICAgIHRoaXMudHJhbnNpdGlvbmluZyA9IDAKICAgICAgdGhpcy4kZWxlbWVudAogICAgICAgIC50\ncmlnZ2VyKCdzaG93bi5icy5jb2xsYXBzZScpCiAgICB9CgogICAgaWYgKCEkLnN1cHBvcnQudHJh\nbnNpdGlvbikgcmV0dXJuIGNvbXBsZXRlLmNhbGwodGhpcykKCiAgICB2YXIgc2Nyb2xsU2l6ZSA9\nICQuY2FtZWxDYXNlKFsnc2Nyb2xsJywgZGltZW5zaW9uXS5qb2luKCctJykpCgogICAgdGhpcy4k\nZWxlbWVudAogICAgICAub25lKCdic1RyYW5zaXRpb25FbmQnLCAkLnByb3h5KGNvbXBsZXRlLCB0\naGlzKSkKICAgICAgLmVtdWxhdGVUcmFuc2l0aW9uRW5kKDM1MClbZGltZW5zaW9uXSh0aGlzLiRl\nbGVtZW50WzBdW3Njcm9sbFNpemVdKQogIH0KCiAgQ29sbGFwc2UucHJvdG90eXBlLmhpZGUgPSBm\ndW5jdGlvbiAoKSB7CiAgICBpZiAodGhpcy50cmFuc2l0aW9uaW5nIHx8ICF0aGlzLiRlbGVtZW50\nLmhhc0NsYXNzKCdpbicpKSByZXR1cm4KCiAgICB2YXIgc3RhcnRFdmVudCA9ICQuRXZlbnQoJ2hp\nZGUuYnMuY29sbGFwc2UnKQogICAgdGhpcy4kZWxlbWVudC50cmlnZ2VyKHN0YXJ0RXZlbnQpCiAg\nICBpZiAoc3RhcnRFdmVudC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgcmV0dXJuCgogICAgdmFyIGRp\nbWVuc2lvbiA9IHRoaXMuZGltZW5zaW9uKCkKCiAgICB0aGlzLiRlbGVtZW50W2RpbWVuc2lvbl0o\ndGhpcy4kZWxlbWVudFtkaW1lbnNpb25dKCkpWzBdLm9mZnNldEhlaWdodAoKICAgIHRoaXMuJGVs\nZW1lbnQKICAgICAgLmFkZENsYXNzKCdjb2xsYXBzaW5nJykKICAgICAgLnJlbW92ZUNsYXNzKCdj\nb2xsYXBzZScpCiAgICAgIC5yZW1vdmVDbGFzcygnaW4nKQoKICAgIHRoaXMudHJhbnNpdGlvbmlu\nZyA9IDEKCiAgICB2YXIgY29tcGxldGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMudHJhbnNp\ndGlvbmluZyA9IDAKICAgICAgdGhpcy4kZWxlbWVudAogICAgICAgIC50cmlnZ2VyKCdoaWRkZW4u\nYnMuY29sbGFwc2UnKQogICAgICAgIC5yZW1vdmVDbGFzcygnY29sbGFwc2luZycpCiAgICAgICAg\nLmFkZENsYXNzKCdjb2xsYXBzZScpCiAgICB9CgogICAgaWYgKCEkLnN1cHBvcnQudHJhbnNpdGlv\nbikgcmV0dXJuIGNvbXBsZXRlLmNhbGwodGhpcykKCiAgICB0aGlzLiRlbGVtZW50CiAgICAgIFtk\naW1lbnNpb25dKDApCiAgICAgIC5vbmUoJ2JzVHJhbnNpdGlvbkVuZCcsICQucHJveHkoY29tcGxl\ndGUsIHRoaXMpKQogICAgICAuZW11bGF0ZVRyYW5zaXRpb25FbmQoMzUwKQogIH0KCiAgQ29sbGFw\nc2UucHJvdG90eXBlLnRvZ2dsZSA9IGZ1bmN0aW9uICgpIHsKICAgIHRoaXNbdGhpcy4kZWxlbWVu\ndC5oYXNDbGFzcygnaW4nKSA/ICdoaWRlJyA6ICdzaG93J10oKQogIH0KCgogIC8vIENPTExBUFNF\nIFBMVUdJTiBERUZJTklUSU9OCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT0KCiAgZnVu\nY3Rpb24gUGx1Z2luKG9wdGlvbikgewogICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7\nCiAgICAgIHZhciAkdGhpcyAgID0gJCh0aGlzKQogICAgICB2YXIgZGF0YSAgICA9ICR0aGlzLmRh\ndGEoJ2JzLmNvbGxhcHNlJykKICAgICAgdmFyIG9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgQ29sbGFw\nc2UuREVGQVVMVFMsICR0aGlzLmRhdGEoKSwgdHlwZW9mIG9wdGlvbiA9PSAnb2JqZWN0JyAmJiBv\ncHRpb24pCgogICAgICBpZiAoIWRhdGEgJiYgb3B0aW9ucy50b2dnbGUgJiYgb3B0aW9uID09ICdz\naG93Jykgb3B0aW9uID0gIW9wdGlvbgogICAgICBpZiAoIWRhdGEpICR0aGlzLmRhdGEoJ2JzLmNv\nbGxhcHNlJywgKGRhdGEgPSBuZXcgQ29sbGFwc2UodGhpcywgb3B0aW9ucykpKQogICAgICBpZiAo\ndHlwZW9mIG9wdGlvbiA9PSAnc3RyaW5nJykgZGF0YVtvcHRpb25dKCkKICAgIH0pCiAgfQoKICB2\nYXIgb2xkID0gJC5mbi5jb2xsYXBzZQoKICAkLmZuLmNvbGxhcHNlICAgICAgICAgICAgID0gUGx1\nZ2luCiAgJC5mbi5jb2xsYXBzZS5Db25zdHJ1Y3RvciA9IENvbGxhcHNlCgoKICAvLyBDT0xMQVBT\nRSBOTyBDT05GTElDVAogIC8vID09PT09PT09PT09PT09PT09PT09CgogICQuZm4uY29sbGFwc2Uu\nbm9Db25mbGljdCA9IGZ1bmN0aW9uICgpIHsKICAgICQuZm4uY29sbGFwc2UgPSBvbGQKICAgIHJl\ndHVybiB0aGlzCiAgfQoKCiAgLy8gQ09MTEFQU0UgREFUQS1BUEkKICAvLyA9PT09PT09PT09PT09\nPT09PQoKICAkKGRvY3VtZW50KS5vbignY2xpY2suYnMuY29sbGFwc2UuZGF0YS1hcGknLCAnW2Rh\ndGEtdG9nZ2xlPSJjb2xsYXBzZSJdJywgZnVuY3Rpb24gKGUpIHsKICAgIHZhciBocmVmCiAgICB2\nYXIgJHRoaXMgICA9ICQodGhpcykKICAgIHZhciB0YXJnZXQgID0gJHRoaXMuYXR0cignZGF0YS10\nYXJnZXQnKQogICAgICAgIHx8IGUucHJldmVudERlZmF1bHQoKQogICAgICAgIHx8IChocmVmID0g\nJHRoaXMuYXR0cignaHJlZicpKSAmJiBocmVmLnJlcGxhY2UoLy4qKD89I1teXHNdKyQpLywgJycp\nIC8vIHN0cmlwIGZvciBpZTcKICAgIHZhciAkdGFyZ2V0ID0gJCh0YXJnZXQpCiAgICB2YXIgZGF0\nYSAgICA9ICR0YXJnZXQuZGF0YSgnYnMuY29sbGFwc2UnKQogICAgdmFyIG9wdGlvbiAgPSBkYXRh\nID8gJ3RvZ2dsZScgOiAkdGhpcy5kYXRhKCkKICAgIHZhciBwYXJlbnQgID0gJHRoaXMuYXR0cign\nZGF0YS1wYXJlbnQnKQogICAgdmFyICRwYXJlbnQgPSBwYXJlbnQgJiYgJChwYXJlbnQpCgogICAg\naWYgKCFkYXRhIHx8ICFkYXRhLnRyYW5zaXRpb25pbmcpIHsKICAgICAgaWYgKCRwYXJlbnQpICRw\nYXJlbnQuZmluZCgnW2RhdGEtdG9nZ2xlPSJjb2xsYXBzZSJdW2RhdGEtcGFyZW50PSInICsgcGFy\nZW50ICsgJyJdJykubm90KCR0aGlzKS5hZGRDbGFzcygnY29sbGFwc2VkJykKICAgICAgJHRoaXNb\nJHRhcmdldC5oYXNDbGFzcygnaW4nKSA/ICdhZGRDbGFzcycgOiAncmVtb3ZlQ2xhc3MnXSgnY29s\nbGFwc2VkJykKICAgIH0KCiAgICBQbHVnaW4uY2FsbCgkdGFyZ2V0LCBvcHRpb24pCiAgfSkKCn0o\nalF1ZXJ5KTsKCi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PQogKiBCb290c3RyYXA6IGRyb3Bkb3duLmpzIHYz\nLjIuMAogKiBodHRwOi8vZ2V0Ym9vdHN0cmFwLmNvbS9qYXZhc2NyaXB0LyNkcm9wZG93bnMKICog\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09CiAqIENvcHlyaWdodCAyMDExLTIwMTQgVHdpdHRlciwgSW5jLgogKiBM\naWNlbnNlZCB1bmRlciBNSVQgKGh0dHBzOi8vZ2l0aHViLmNvbS90d2JzL2Jvb3RzdHJhcC9ibG9i\nL21hc3Rlci9MSUNFTlNFKQogKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KCgorZnVuY3Rpb24gKCQpIHsK\nICAndXNlIHN0cmljdCc7CgogIC8vIERST1BET1dOIENMQVNTIERFRklOSVRJT04KICAvLyA9PT09\nPT09PT09PT09PT09PT09PT09PT09CgogIHZhciBiYWNrZHJvcCA9ICcuZHJvcGRvd24tYmFja2Ry\nb3AnCiAgdmFyIHRvZ2dsZSAgID0gJ1tkYXRhLXRvZ2dsZT0iZHJvcGRvd24iXScKICB2YXIgRHJv\ncGRvd24gPSBmdW5jdGlvbiAoZWxlbWVudCkgewogICAgJChlbGVtZW50KS5vbignY2xpY2suYnMu\nZHJvcGRvd24nLCB0aGlzLnRvZ2dsZSkKICB9CgogIERyb3Bkb3duLlZFUlNJT04gPSAnMy4yLjAn\nCgogIERyb3Bkb3duLnByb3RvdHlwZS50b2dnbGUgPSBmdW5jdGlvbiAoZSkgewogICAgdmFyICR0\naGlzID0gJCh0aGlzKQoKICAgIGlmICgkdGhpcy5pcygnLmRpc2FibGVkLCA6ZGlzYWJsZWQnKSkg\ncmV0dXJuCgogICAgdmFyICRwYXJlbnQgID0gZ2V0UGFyZW50KCR0aGlzKQogICAgdmFyIGlzQWN0\naXZlID0gJHBhcmVudC5oYXNDbGFzcygnb3BlbicpCgogICAgY2xlYXJNZW51cygpCgogICAgaWYg\nKCFpc0FjdGl2ZSkgewogICAgICBpZiAoJ29udG91Y2hzdGFydCcgaW4gZG9jdW1lbnQuZG9jdW1l\nbnRFbGVtZW50ICYmICEkcGFyZW50LmNsb3Nlc3QoJy5uYXZiYXItbmF2JykubGVuZ3RoKSB7CiAg\nICAgICAgLy8gaWYgbW9iaWxlIHdlIHVzZSBhIGJhY2tkcm9wIGJlY2F1c2UgY2xpY2sgZXZlbnRz\nIGRvbid0IGRlbGVnYXRlCiAgICAgICAgJCgnPGRpdiBjbGFzcz0iZHJvcGRvd24tYmFja2Ryb3Ai\nLz4nKS5pbnNlcnRBZnRlcigkKHRoaXMpKS5vbignY2xpY2snLCBjbGVhck1lbnVzKQogICAgICB9\nCgogICAgICB2YXIgcmVsYXRlZFRhcmdldCA9IHsgcmVsYXRlZFRhcmdldDogdGhpcyB9CiAgICAg\nICRwYXJlbnQudHJpZ2dlcihlID0gJC5FdmVudCgnc2hvdy5icy5kcm9wZG93bicsIHJlbGF0ZWRU\nYXJnZXQpKQoKICAgICAgaWYgKGUuaXNEZWZhdWx0UHJldmVudGVkKCkpIHJldHVybgoKICAgICAg\nJHRoaXMudHJpZ2dlcignZm9jdXMnKQoKICAgICAgJHBhcmVudAogICAgICAgIC50b2dnbGVDbGFz\ncygnb3BlbicpCiAgICAgICAgLnRyaWdnZXIoJ3Nob3duLmJzLmRyb3Bkb3duJywgcmVsYXRlZFRh\ncmdldCkKICAgIH0KCiAgICByZXR1cm4gZmFsc2UKICB9CgogIERyb3Bkb3duLnByb3RvdHlwZS5r\nZXlkb3duID0gZnVuY3Rpb24gKGUpIHsKICAgIGlmICghLygzOHw0MHwyNykvLnRlc3QoZS5rZXlD\nb2RlKSkgcmV0dXJuCgogICAgdmFyICR0aGlzID0gJCh0aGlzKQoKICAgIGUucHJldmVudERlZmF1\nbHQoKQogICAgZS5zdG9wUHJvcGFnYXRpb24oKQoKICAgIGlmICgkdGhpcy5pcygnLmRpc2FibGVk\nLCA6ZGlzYWJsZWQnKSkgcmV0dXJuCgogICAgdmFyICRwYXJlbnQgID0gZ2V0UGFyZW50KCR0aGlz\nKQogICAgdmFyIGlzQWN0aXZlID0gJHBhcmVudC5oYXNDbGFzcygnb3BlbicpCgogICAgaWYgKCFp\nc0FjdGl2ZSB8fCAoaXNBY3RpdmUgJiYgZS5rZXlDb2RlID09IDI3KSkgewogICAgICBpZiAoZS53\naGljaCA9PSAyNykgJHBhcmVudC5maW5kKHRvZ2dsZSkudHJpZ2dlcignZm9jdXMnKQogICAgICBy\nZXR1cm4gJHRoaXMudHJpZ2dlcignY2xpY2snKQogICAgfQoKICAgIHZhciBkZXNjID0gJyBsaTpu\nb3QoLmRpdmlkZXIpOnZpc2libGUgYScKICAgIHZhciAkaXRlbXMgPSAkcGFyZW50LmZpbmQoJ1ty\nb2xlPSJtZW51Il0nICsgZGVzYyArICcsIFtyb2xlPSJsaXN0Ym94Il0nICsgZGVzYykKCiAgICBp\nZiAoISRpdGVtcy5sZW5ndGgpIHJldHVybgoKICAgIHZhciBpbmRleCA9ICRpdGVtcy5pbmRleCgk\naXRlbXMuZmlsdGVyKCc6Zm9jdXMnKSkKCiAgICBpZiAoZS5rZXlDb2RlID09IDM4ICYmIGluZGV4\nID4gMCkgICAgICAgICAgICAgICAgIGluZGV4LS0gICAgICAgICAgICAgICAgICAgICAgICAvLyB1\ncAogICAgaWYgKGUua2V5Q29kZSA9PSA0MCAmJiBpbmRleCA8ICRpdGVtcy5sZW5ndGggLSAxKSBp\nbmRleCsrICAgICAgICAgICAgICAgICAgICAgICAgLy8gZG93bgogICAgaWYgKCF+aW5kZXgpICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleCA9IDAKCiAgICAkaXRlbXMu\nZXEoaW5kZXgpLnRyaWdnZXIoJ2ZvY3VzJykKICB9CgogIGZ1bmN0aW9uIGNsZWFyTWVudXMoZSkg\newogICAgaWYgKGUgJiYgZS53aGljaCA9PT0gMykgcmV0dXJuCiAgICAkKGJhY2tkcm9wKS5yZW1v\ndmUoKQogICAgJCh0b2dnbGUpLmVhY2goZnVuY3Rpb24gKCkgewogICAgICB2YXIgJHBhcmVudCA9\nIGdldFBhcmVudCgkKHRoaXMpKQogICAgICB2YXIgcmVsYXRlZFRhcmdldCA9IHsgcmVsYXRlZFRh\ncmdldDogdGhpcyB9CiAgICAgIGlmICghJHBhcmVudC5oYXNDbGFzcygnb3BlbicpKSByZXR1cm4K\nICAgICAgJHBhcmVudC50cmlnZ2VyKGUgPSAkLkV2ZW50KCdoaWRlLmJzLmRyb3Bkb3duJywgcmVs\nYXRlZFRhcmdldCkpCiAgICAgIGlmIChlLmlzRGVmYXVsdFByZXZlbnRlZCgpKSByZXR1cm4KICAg\nICAgJHBhcmVudC5yZW1vdmVDbGFzcygnb3BlbicpLnRyaWdnZXIoJ2hpZGRlbi5icy5kcm9wZG93\nbicsIHJlbGF0ZWRUYXJnZXQpCiAgICB9KQogIH0KCiAgZnVuY3Rpb24gZ2V0UGFyZW50KCR0aGlz\nKSB7CiAgICB2YXIgc2VsZWN0b3IgPSAkdGhpcy5hdHRyKCdkYXRhLXRhcmdldCcpCgogICAgaWYg\nKCFzZWxlY3RvcikgewogICAgICBzZWxlY3RvciA9ICR0aGlzLmF0dHIoJ2hyZWYnKQogICAgICBz\nZWxlY3RvciA9IHNlbGVjdG9yICYmIC8jW0EtWmEtel0vLnRlc3Qoc2VsZWN0b3IpICYmIHNlbGVj\ndG9yLnJlcGxhY2UoLy4qKD89I1teXHNdKiQpLywgJycpIC8vIHN0cmlwIGZvciBpZTcKICAgIH0K\nCiAgICB2YXIgJHBhcmVudCA9IHNlbGVjdG9yICYmICQoc2VsZWN0b3IpCgogICAgcmV0dXJuICRw\nYXJlbnQgJiYgJHBhcmVudC5sZW5ndGggPyAkcGFyZW50IDogJHRoaXMucGFyZW50KCkKICB9CgoK\nICAvLyBEUk9QRE9XTiBQTFVHSU4gREVGSU5JVElPTgogIC8vID09PT09PT09PT09PT09PT09PT09\nPT09PT09CgogIGZ1bmN0aW9uIFBsdWdpbihvcHRpb24pIHsKICAgIHJldHVybiB0aGlzLmVhY2go\nZnVuY3Rpb24gKCkgewogICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpCiAgICAgIHZhciBkYXRhICA9\nICR0aGlzLmRhdGEoJ2JzLmRyb3Bkb3duJykKCiAgICAgIGlmICghZGF0YSkgJHRoaXMuZGF0YSgn\nYnMuZHJvcGRvd24nLCAoZGF0YSA9IG5ldyBEcm9wZG93bih0aGlzKSkpCiAgICAgIGlmICh0eXBl\nb2Ygb3B0aW9uID09ICdzdHJpbmcnKSBkYXRhW29wdGlvbl0uY2FsbCgkdGhpcykKICAgIH0pCiAg\nfQoKICB2YXIgb2xkID0gJC5mbi5kcm9wZG93bgoKICAkLmZuLmRyb3Bkb3duICAgICAgICAgICAg\nID0gUGx1Z2luCiAgJC5mbi5kcm9wZG93bi5Db25zdHJ1Y3RvciA9IERyb3Bkb3duCgoKICAvLyBE\nUk9QRE9XTiBOTyBDT05GTElDVAogIC8vID09PT09PT09PT09PT09PT09PT09CgogICQuZm4uZHJv\ncGRvd24ubm9Db25mbGljdCA9IGZ1bmN0aW9uICgpIHsKICAgICQuZm4uZHJvcGRvd24gPSBvbGQK\nICAgIHJldHVybiB0aGlzCiAgfQoKCiAgLy8gQVBQTFkgVE8gU1RBTkRBUkQgRFJPUERPV04gRUxF\nTUVOVFMKICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKICAkKGRvY3Vt\nZW50KQogICAgLm9uKCdjbGljay5icy5kcm9wZG93bi5kYXRhLWFwaScsIGNsZWFyTWVudXMpCiAg\nICAub24oJ2NsaWNrLmJzLmRyb3Bkb3duLmRhdGEtYXBpJywgJy5kcm9wZG93biBmb3JtJywgZnVu\nY3Rpb24gKGUpIHsgZS5zdG9wUHJvcGFnYXRpb24oKSB9KQogICAgLm9uKCdjbGljay5icy5kcm9w\nZG93bi5kYXRhLWFwaScsIHRvZ2dsZSwgRHJvcGRvd24ucHJvdG90eXBlLnRvZ2dsZSkKICAgIC5v\nbigna2V5ZG93bi5icy5kcm9wZG93bi5kYXRhLWFwaScsIHRvZ2dsZSArICcsIFtyb2xlPSJtZW51\nIl0sIFtyb2xlPSJsaXN0Ym94Il0nLCBEcm9wZG93bi5wcm90b3R5cGUua2V5ZG93bikKCn0oalF1\nZXJ5KTsKCi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PQogKiBCb290c3RyYXA6IG1vZGFsLmpzIHYzLjIuMAog\nKiBodHRwOi8vZ2V0Ym9vdHN0cmFwLmNvbS9qYXZhc2NyaXB0LyNtb2RhbHMKICogPT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09CiAqIENvcHlyaWdodCAyMDExLTIwMTQgVHdpdHRlciwgSW5jLgogKiBMaWNlbnNlZCB1\nbmRlciBNSVQgKGh0dHBzOi8vZ2l0aHViLmNvbS90d2JzL2Jvb3RzdHJhcC9ibG9iL21hc3Rlci9M\nSUNFTlNFKQogKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KCgorZnVuY3Rpb24gKCQpIHsKICAndXNlIHN0\ncmljdCc7CgogIC8vIE1PREFMIENMQVNTIERFRklOSVRJT04KICAvLyA9PT09PT09PT09PT09PT09\nPT09PT09CgogIHZhciBNb2RhbCA9IGZ1bmN0aW9uIChlbGVtZW50LCBvcHRpb25zKSB7CiAgICB0\naGlzLm9wdGlvbnMgICAgICAgID0gb3B0aW9ucwogICAgdGhpcy4kYm9keSAgICAgICAgICA9ICQo\nZG9jdW1lbnQuYm9keSkKICAgIHRoaXMuJGVsZW1lbnQgICAgICAgPSAkKGVsZW1lbnQpCiAgICB0\naGlzLiRiYWNrZHJvcCAgICAgID0KICAgIHRoaXMuaXNTaG93biAgICAgICAgPSBudWxsCiAgICB0\naGlzLnNjcm9sbGJhcldpZHRoID0gMAoKICAgIGlmICh0aGlzLm9wdGlvbnMucmVtb3RlKSB7CiAg\nICAgIHRoaXMuJGVsZW1lbnQKICAgICAgICAuZmluZCgnLm1vZGFsLWNvbnRlbnQnKQogICAgICAg\nIC5sb2FkKHRoaXMub3B0aW9ucy5yZW1vdGUsICQucHJveHkoZnVuY3Rpb24gKCkgewogICAgICAg\nICAgdGhpcy4kZWxlbWVudC50cmlnZ2VyKCdsb2FkZWQuYnMubW9kYWwnKQogICAgICAgIH0sIHRo\naXMpKQogICAgfQogIH0KCiAgTW9kYWwuVkVSU0lPTiAgPSAnMy4yLjAnCgogIE1vZGFsLkRFRkFV\nTFRTID0gewogICAgYmFja2Ryb3A6IHRydWUsCiAgICBrZXlib2FyZDogdHJ1ZSwKICAgIHNob3c6\nIHRydWUKICB9CgogIE1vZGFsLnByb3RvdHlwZS50b2dnbGUgPSBmdW5jdGlvbiAoX3JlbGF0ZWRU\nYXJnZXQpIHsKICAgIHJldHVybiB0aGlzLmlzU2hvd24gPyB0aGlzLmhpZGUoKSA6IHRoaXMuc2hv\ndyhfcmVsYXRlZFRhcmdldCkKICB9CgogIE1vZGFsLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24g\nKF9yZWxhdGVkVGFyZ2V0KSB7CiAgICB2YXIgdGhhdCA9IHRoaXMKICAgIHZhciBlICAgID0gJC5F\ndmVudCgnc2hvdy5icy5tb2RhbCcsIHsgcmVsYXRlZFRhcmdldDogX3JlbGF0ZWRUYXJnZXQgfSkK\nCiAgICB0aGlzLiRlbGVtZW50LnRyaWdnZXIoZSkKCiAgICBpZiAodGhpcy5pc1Nob3duIHx8IGUu\naXNEZWZhdWx0UHJldmVudGVkKCkpIHJldHVybgoKICAgIHRoaXMuaXNTaG93biA9IHRydWUKCiAg\nICB0aGlzLmNoZWNrU2Nyb2xsYmFyKCkKICAgIHRoaXMuJGJvZHkuYWRkQ2xhc3MoJ21vZGFsLW9w\nZW4nKQoKICAgIHRoaXMuc2V0U2Nyb2xsYmFyKCkKICAgIHRoaXMuZXNjYXBlKCkKCiAgICB0aGlz\nLiRlbGVtZW50Lm9uKCdjbGljay5kaXNtaXNzLmJzLm1vZGFsJywgJ1tkYXRhLWRpc21pc3M9Im1v\nZGFsIl0nLCAkLnByb3h5KHRoaXMuaGlkZSwgdGhpcykpCgogICAgdGhpcy5iYWNrZHJvcChmdW5j\ndGlvbiAoKSB7CiAgICAgIHZhciB0cmFuc2l0aW9uID0gJC5zdXBwb3J0LnRyYW5zaXRpb24gJiYg\ndGhhdC4kZWxlbWVudC5oYXNDbGFzcygnZmFkZScpCgogICAgICBpZiAoIXRoYXQuJGVsZW1lbnQu\ncGFyZW50KCkubGVuZ3RoKSB7CiAgICAgICAgdGhhdC4kZWxlbWVudC5hcHBlbmRUbyh0aGF0LiRi\nb2R5KSAvLyBkb24ndCBtb3ZlIG1vZGFscyBkb20gcG9zaXRpb24KICAgICAgfQoKICAgICAgdGhh\ndC4kZWxlbWVudAogICAgICAgIC5zaG93KCkKICAgICAgICAuc2Nyb2xsVG9wKDApCgogICAgICBp\nZiAodHJhbnNpdGlvbikgewogICAgICAgIHRoYXQuJGVsZW1lbnRbMF0ub2Zmc2V0V2lkdGggLy8g\nZm9yY2UgcmVmbG93CiAgICAgIH0KCiAgICAgIHRoYXQuJGVsZW1lbnQKICAgICAgICAuYWRkQ2xh\nc3MoJ2luJykKICAgICAgICAuYXR0cignYXJpYS1oaWRkZW4nLCBmYWxzZSkKCiAgICAgIHRoYXQu\nZW5mb3JjZUZvY3VzKCkKCiAgICAgIHZhciBlID0gJC5FdmVudCgnc2hvd24uYnMubW9kYWwnLCB7\nIHJlbGF0ZWRUYXJnZXQ6IF9yZWxhdGVkVGFyZ2V0IH0pCgogICAgICB0cmFuc2l0aW9uID8KICAg\nICAgICB0aGF0LiRlbGVtZW50LmZpbmQoJy5tb2RhbC1kaWFsb2cnKSAvLyB3YWl0IGZvciBtb2Rh\nbCB0byBzbGlkZSBpbgogICAgICAgICAgLm9uZSgnYnNUcmFuc2l0aW9uRW5kJywgZnVuY3Rpb24g\nKCkgewogICAgICAgICAgICB0aGF0LiRlbGVtZW50LnRyaWdnZXIoJ2ZvY3VzJykudHJpZ2dlcihl\nKQogICAgICAgICAgfSkKICAgICAgICAgIC5lbXVsYXRlVHJhbnNpdGlvbkVuZCgzMDApIDoKICAg\nICAgICB0aGF0LiRlbGVtZW50LnRyaWdnZXIoJ2ZvY3VzJykudHJpZ2dlcihlKQogICAgfSkKICB9\nCgogIE1vZGFsLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24gKGUpIHsKICAgIGlmIChlKSBlLnBy\nZXZlbnREZWZhdWx0KCkKCiAgICBlID0gJC5FdmVudCgnaGlkZS5icy5tb2RhbCcpCgogICAgdGhp\ncy4kZWxlbWVudC50cmlnZ2VyKGUpCgogICAgaWYgKCF0aGlzLmlzU2hvd24gfHwgZS5pc0RlZmF1\nbHRQcmV2ZW50ZWQoKSkgcmV0dXJuCgogICAgdGhpcy5pc1Nob3duID0gZmFsc2UKCiAgICB0aGlz\nLiRib2R5LnJlbW92ZUNsYXNzKCdtb2RhbC1vcGVuJykKCiAgICB0aGlzLnJlc2V0U2Nyb2xsYmFy\nKCkKICAgIHRoaXMuZXNjYXBlKCkKCiAgICAkKGRvY3VtZW50KS5vZmYoJ2ZvY3VzaW4uYnMubW9k\nYWwnKQoKICAgIHRoaXMuJGVsZW1lbnQKICAgICAgLnJlbW92ZUNsYXNzKCdpbicpCiAgICAgIC5h\ndHRyKCdhcmlhLWhpZGRlbicsIHRydWUpCiAgICAgIC5vZmYoJ2NsaWNrLmRpc21pc3MuYnMubW9k\nYWwnKQoKICAgICQuc3VwcG9ydC50cmFuc2l0aW9uICYmIHRoaXMuJGVsZW1lbnQuaGFzQ2xhc3Mo\nJ2ZhZGUnKSA/CiAgICAgIHRoaXMuJGVsZW1lbnQKICAgICAgICAub25lKCdic1RyYW5zaXRpb25F\nbmQnLCAkLnByb3h5KHRoaXMuaGlkZU1vZGFsLCB0aGlzKSkKICAgICAgICAuZW11bGF0ZVRyYW5z\naXRpb25FbmQoMzAwKSA6CiAgICAgIHRoaXMuaGlkZU1vZGFsKCkKICB9CgogIE1vZGFsLnByb3Rv\ndHlwZS5lbmZvcmNlRm9jdXMgPSBmdW5jdGlvbiAoKSB7CiAgICAkKGRvY3VtZW50KQogICAgICAu\nb2ZmKCdmb2N1c2luLmJzLm1vZGFsJykgLy8gZ3VhcmQgYWdhaW5zdCBpbmZpbml0ZSBmb2N1cyBs\nb29wCiAgICAgIC5vbignZm9jdXNpbi5icy5tb2RhbCcsICQucHJveHkoZnVuY3Rpb24gKGUpIHsK\nICAgICAgICBpZiAodGhpcy4kZWxlbWVudFswXSAhPT0gZS50YXJnZXQgJiYgIXRoaXMuJGVsZW1l\nbnQuaGFzKGUudGFyZ2V0KS5sZW5ndGgpIHsKICAgICAgICAgIHRoaXMuJGVsZW1lbnQudHJpZ2dl\ncignZm9jdXMnKQogICAgICAgIH0KICAgICAgfSwgdGhpcykpCiAgfQoKICBNb2RhbC5wcm90b3R5\ncGUuZXNjYXBlID0gZnVuY3Rpb24gKCkgewogICAgaWYgKHRoaXMuaXNTaG93biAmJiB0aGlzLm9w\ndGlvbnMua2V5Ym9hcmQpIHsKICAgICAgdGhpcy4kZWxlbWVudC5vbigna2V5dXAuZGlzbWlzcy5i\ncy5tb2RhbCcsICQucHJveHkoZnVuY3Rpb24gKGUpIHsKICAgICAgICBlLndoaWNoID09IDI3ICYm\nIHRoaXMuaGlkZSgpCiAgICAgIH0sIHRoaXMpKQogICAgfSBlbHNlIGlmICghdGhpcy5pc1Nob3du\nKSB7CiAgICAgIHRoaXMuJGVsZW1lbnQub2ZmKCdrZXl1cC5kaXNtaXNzLmJzLm1vZGFsJykKICAg\nIH0KICB9CgogIE1vZGFsLnByb3RvdHlwZS5oaWRlTW9kYWwgPSBmdW5jdGlvbiAoKSB7CiAgICB2\nYXIgdGhhdCA9IHRoaXMKICAgIHRoaXMuJGVsZW1lbnQuaGlkZSgpCiAgICB0aGlzLmJhY2tkcm9w\nKGZ1bmN0aW9uICgpIHsKICAgICAgdGhhdC4kZWxlbWVudC50cmlnZ2VyKCdoaWRkZW4uYnMubW9k\nYWwnKQogICAgfSkKICB9CgogIE1vZGFsLnByb3RvdHlwZS5yZW1vdmVCYWNrZHJvcCA9IGZ1bmN0\naW9uICgpIHsKICAgIHRoaXMuJGJhY2tkcm9wICYmIHRoaXMuJGJhY2tkcm9wLnJlbW92ZSgpCiAg\nICB0aGlzLiRiYWNrZHJvcCA9IG51bGwKICB9CgogIE1vZGFsLnByb3RvdHlwZS5iYWNrZHJvcCA9\nIGZ1bmN0aW9uIChjYWxsYmFjaykgewogICAgdmFyIHRoYXQgPSB0aGlzCiAgICB2YXIgYW5pbWF0\nZSA9IHRoaXMuJGVsZW1lbnQuaGFzQ2xhc3MoJ2ZhZGUnKSA/ICdmYWRlJyA6ICcnCgogICAgaWYg\nKHRoaXMuaXNTaG93biAmJiB0aGlzLm9wdGlvbnMuYmFja2Ryb3ApIHsKICAgICAgdmFyIGRvQW5p\nbWF0ZSA9ICQuc3VwcG9ydC50cmFuc2l0aW9uICYmIGFuaW1hdGUKCiAgICAgIHRoaXMuJGJhY2tk\ncm9wID0gJCgnPGRpdiBjbGFzcz0ibW9kYWwtYmFja2Ryb3AgJyArIGFuaW1hdGUgKyAnIiAvPicp\nCiAgICAgICAgLmFwcGVuZFRvKHRoaXMuJGJvZHkpCgogICAgICB0aGlzLiRlbGVtZW50Lm9uKCdj\nbGljay5kaXNtaXNzLmJzLm1vZGFsJywgJC5wcm94eShmdW5jdGlvbiAoZSkgewogICAgICAgIGlm\nIChlLnRhcmdldCAhPT0gZS5jdXJyZW50VGFyZ2V0KSByZXR1cm4KICAgICAgICB0aGlzLm9wdGlv\nbnMuYmFja2Ryb3AgPT0gJ3N0YXRpYycKICAgICAgICAgID8gdGhpcy4kZWxlbWVudFswXS5mb2N1\ncy5jYWxsKHRoaXMuJGVsZW1lbnRbMF0pCiAgICAgICAgICA6IHRoaXMuaGlkZS5jYWxsKHRoaXMp\nCiAgICAgIH0sIHRoaXMpKQoKICAgICAgaWYgKGRvQW5pbWF0ZSkgdGhpcy4kYmFja2Ryb3BbMF0u\nb2Zmc2V0V2lkdGggLy8gZm9yY2UgcmVmbG93CgogICAgICB0aGlzLiRiYWNrZHJvcC5hZGRDbGFz\ncygnaW4nKQoKICAgICAgaWYgKCFjYWxsYmFjaykgcmV0dXJuCgogICAgICBkb0FuaW1hdGUgPwog\nICAgICAgIHRoaXMuJGJhY2tkcm9wCiAgICAgICAgICAub25lKCdic1RyYW5zaXRpb25FbmQnLCBj\nYWxsYmFjaykKICAgICAgICAgIC5lbXVsYXRlVHJhbnNpdGlvbkVuZCgxNTApIDoKICAgICAgICBj\nYWxsYmFjaygpCgogICAgfSBlbHNlIGlmICghdGhpcy5pc1Nob3duICYmIHRoaXMuJGJhY2tkcm9w\nKSB7CiAgICAgIHRoaXMuJGJhY2tkcm9wLnJlbW92ZUNsYXNzKCdpbicpCgogICAgICB2YXIgY2Fs\nbGJhY2tSZW1vdmUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhhdC5yZW1vdmVCYWNrZHJvcCgp\nCiAgICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soKQogICAgICB9CiAgICAgICQuc3VwcG9ydC50\ncmFuc2l0aW9uICYmIHRoaXMuJGVsZW1lbnQuaGFzQ2xhc3MoJ2ZhZGUnKSA/CiAgICAgICAgdGhp\ncy4kYmFja2Ryb3AKICAgICAgICAgIC5vbmUoJ2JzVHJhbnNpdGlvbkVuZCcsIGNhbGxiYWNrUmVt\nb3ZlKQogICAgICAgICAgLmVtdWxhdGVUcmFuc2l0aW9uRW5kKDE1MCkgOgogICAgICAgIGNhbGxi\nYWNrUmVtb3ZlKCkKCiAgICB9IGVsc2UgaWYgKGNhbGxiYWNrKSB7CiAgICAgIGNhbGxiYWNrKCkK\nICAgIH0KICB9CgogIE1vZGFsLnByb3RvdHlwZS5jaGVja1Njcm9sbGJhciA9IGZ1bmN0aW9uICgp\nIHsKICAgIGlmIChkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoID49IHdpbmRvdy5pbm5lcldpZHRo\nKSByZXR1cm4KICAgIHRoaXMuc2Nyb2xsYmFyV2lkdGggPSB0aGlzLnNjcm9sbGJhcldpZHRoIHx8\nIHRoaXMubWVhc3VyZVNjcm9sbGJhcigpCiAgfQoKICBNb2RhbC5wcm90b3R5cGUuc2V0U2Nyb2xs\nYmFyID0gZnVuY3Rpb24gKCkgewogICAgdmFyIGJvZHlQYWQgPSBwYXJzZUludCgodGhpcy4kYm9k\neS5jc3MoJ3BhZGRpbmctcmlnaHQnKSB8fCAwKSwgMTApCiAgICBpZiAodGhpcy5zY3JvbGxiYXJX\naWR0aCkgdGhpcy4kYm9keS5jc3MoJ3BhZGRpbmctcmlnaHQnLCBib2R5UGFkICsgdGhpcy5zY3Jv\nbGxiYXJXaWR0aCkKICB9CgogIE1vZGFsLnByb3RvdHlwZS5yZXNldFNjcm9sbGJhciA9IGZ1bmN0\naW9uICgpIHsKICAgIHRoaXMuJGJvZHkuY3NzKCdwYWRkaW5nLXJpZ2h0JywgJycpCiAgfQoKICBN\nb2RhbC5wcm90b3R5cGUubWVhc3VyZVNjcm9sbGJhciA9IGZ1bmN0aW9uICgpIHsgLy8gdGh4IHdh\nbHNoCiAgICB2YXIgc2Nyb2xsRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykKICAg\nIHNjcm9sbERpdi5jbGFzc05hbWUgPSAnbW9kYWwtc2Nyb2xsYmFyLW1lYXN1cmUnCiAgICB0aGlz\nLiRib2R5LmFwcGVuZChzY3JvbGxEaXYpCiAgICB2YXIgc2Nyb2xsYmFyV2lkdGggPSBzY3JvbGxE\naXYub2Zmc2V0V2lkdGggLSBzY3JvbGxEaXYuY2xpZW50V2lkdGgKICAgIHRoaXMuJGJvZHlbMF0u\ncmVtb3ZlQ2hpbGQoc2Nyb2xsRGl2KQogICAgcmV0dXJuIHNjcm9sbGJhcldpZHRoCiAgfQoKCiAg\nLy8gTU9EQUwgUExVR0lOIERFRklOSVRJT04KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PQoK\nICBmdW5jdGlvbiBQbHVnaW4ob3B0aW9uLCBfcmVsYXRlZFRhcmdldCkgewogICAgcmV0dXJuIHRo\naXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgIHZhciAkdGhpcyAgID0gJCh0aGlzKQogICAgICB2\nYXIgZGF0YSAgICA9ICR0aGlzLmRhdGEoJ2JzLm1vZGFsJykKICAgICAgdmFyIG9wdGlvbnMgPSAk\nLmV4dGVuZCh7fSwgTW9kYWwuREVGQVVMVFMsICR0aGlzLmRhdGEoKSwgdHlwZW9mIG9wdGlvbiA9\nPSAnb2JqZWN0JyAmJiBvcHRpb24pCgogICAgICBpZiAoIWRhdGEpICR0aGlzLmRhdGEoJ2JzLm1v\nZGFsJywgKGRhdGEgPSBuZXcgTW9kYWwodGhpcywgb3B0aW9ucykpKQogICAgICBpZiAodHlwZW9m\nIG9wdGlvbiA9PSAnc3RyaW5nJykgZGF0YVtvcHRpb25dKF9yZWxhdGVkVGFyZ2V0KQogICAgICBl\nbHNlIGlmIChvcHRpb25zLnNob3cpIGRhdGEuc2hvdyhfcmVsYXRlZFRhcmdldCkKICAgIH0pCiAg\nfQoKICB2YXIgb2xkID0gJC5mbi5tb2RhbAoKICAkLmZuLm1vZGFsICAgICAgICAgICAgID0gUGx1\nZ2luCiAgJC5mbi5tb2RhbC5Db25zdHJ1Y3RvciA9IE1vZGFsCgoKICAvLyBNT0RBTCBOTyBDT05G\nTElDVAogIC8vID09PT09PT09PT09PT09PT09CgogICQuZm4ubW9kYWwubm9Db25mbGljdCA9IGZ1\nbmN0aW9uICgpIHsKICAgICQuZm4ubW9kYWwgPSBvbGQKICAgIHJldHVybiB0aGlzCiAgfQoKCiAg\nLy8gTU9EQUwgREFUQS1BUEkKICAvLyA9PT09PT09PT09PT09PQoKICAkKGRvY3VtZW50KS5vbign\nY2xpY2suYnMubW9kYWwuZGF0YS1hcGknLCAnW2RhdGEtdG9nZ2xlPSJtb2RhbCJdJywgZnVuY3Rp\nb24gKGUpIHsKICAgIHZhciAkdGhpcyAgID0gJCh0aGlzKQogICAgdmFyIGhyZWYgICAgPSAkdGhp\ncy5hdHRyKCdocmVmJykKICAgIHZhciAkdGFyZ2V0ID0gJCgkdGhpcy5hdHRyKCdkYXRhLXRhcmdl\ndCcpIHx8IChocmVmICYmIGhyZWYucmVwbGFjZSgvLiooPz0jW15cc10rJCkvLCAnJykpKSAvLyBz\ndHJpcCBmb3IgaWU3CiAgICB2YXIgb3B0aW9uICA9ICR0YXJnZXQuZGF0YSgnYnMubW9kYWwnKSA/\nICd0b2dnbGUnIDogJC5leHRlbmQoeyByZW1vdGU6ICEvIy8udGVzdChocmVmKSAmJiBocmVmIH0s\nICR0YXJnZXQuZGF0YSgpLCAkdGhpcy5kYXRhKCkpCgogICAgaWYgKCR0aGlzLmlzKCdhJykpIGUu\ncHJldmVudERlZmF1bHQoKQoKICAgICR0YXJnZXQub25lKCdzaG93LmJzLm1vZGFsJywgZnVuY3Rp\nb24gKHNob3dFdmVudCkgewogICAgICBpZiAoc2hvd0V2ZW50LmlzRGVmYXVsdFByZXZlbnRlZCgp\nKSByZXR1cm4gLy8gb25seSByZWdpc3RlciBmb2N1cyByZXN0b3JlciBpZiBtb2RhbCB3aWxsIGFj\ndHVhbGx5IGdldCBzaG93bgogICAgICAkdGFyZ2V0Lm9uZSgnaGlkZGVuLmJzLm1vZGFsJywgZnVu\nY3Rpb24gKCkgewogICAgICAgICR0aGlzLmlzKCc6dmlzaWJsZScpICYmICR0aGlzLnRyaWdnZXIo\nJ2ZvY3VzJykKICAgICAgfSkKICAgIH0pCiAgICBQbHVnaW4uY2FsbCgkdGFyZ2V0LCBvcHRpb24s\nIHRoaXMpCiAgfSkKCn0oalF1ZXJ5KTsKCi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogKiBCb290c3RyYXA6\nIHRvb2x0aXAuanMgdjMuMi4wCiAqIGh0dHA6Ly9nZXRib290c3RyYXAuY29tL2phdmFzY3JpcHQv\nI3Rvb2x0aXAKICogSW5zcGlyZWQgYnkgdGhlIG9yaWdpbmFsIGpRdWVyeS50aXBzeSBieSBKYXNv\nbiBGcmFtZQogKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT0KICogQ29weXJpZ2h0IDIwMTEtMjAxNCBUd2l0dGVy\nLCBJbmMuCiAqIExpY2Vuc2VkIHVuZGVyIE1JVCAoaHR0cHM6Ly9naXRodWIuY29tL3R3YnMvYm9v\ndHN0cmFwL2Jsb2IvbWFzdGVyL0xJQ0VOU0UpCiAqID09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwoKCitmdW5j\ndGlvbiAoJCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLy8gVE9PTFRJUCBQVUJMSUMgQ0xBU1MgREVG\nSU5JVElPTgogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiAgdmFyIFRvb2x0\naXAgPSBmdW5jdGlvbiAoZWxlbWVudCwgb3B0aW9ucykgewogICAgdGhpcy50eXBlICAgICAgID0K\nICAgIHRoaXMub3B0aW9ucyAgICA9CiAgICB0aGlzLmVuYWJsZWQgICAgPQogICAgdGhpcy50aW1l\nb3V0ICAgID0KICAgIHRoaXMuaG92ZXJTdGF0ZSA9CiAgICB0aGlzLiRlbGVtZW50ICAgPSBudWxs\nCgogICAgdGhpcy5pbml0KCd0b29sdGlwJywgZWxlbWVudCwgb3B0aW9ucykKICB9CgogIFRvb2x0\naXAuVkVSU0lPTiAgPSAnMy4yLjAnCgogIFRvb2x0aXAuREVGQVVMVFMgPSB7CiAgICBhbmltYXRp\nb246IHRydWUsCiAgICBwbGFjZW1lbnQ6ICd0b3AnLAogICAgc2VsZWN0b3I6IGZhbHNlLAogICAg\ndGVtcGxhdGU6ICc8ZGl2IGNsYXNzPSJ0b29sdGlwIiByb2xlPSJ0b29sdGlwIj48ZGl2IGNsYXNz\nPSJ0b29sdGlwLWFycm93Ij48L2Rpdj48ZGl2IGNsYXNzPSJ0b29sdGlwLWlubmVyIj48L2Rpdj48\nL2Rpdj4nLAogICAgdHJpZ2dlcjogJ2hvdmVyIGZvY3VzJywKICAgIHRpdGxlOiAnJywKICAgIGRl\nbGF5OiAwLAogICAgaHRtbDogZmFsc2UsCiAgICBjb250YWluZXI6IGZhbHNlLAogICAgdmlld3Bv\ncnQ6IHsKICAgICAgc2VsZWN0b3I6ICdib2R5JywKICAgICAgcGFkZGluZzogMAogICAgfQogIH0K\nCiAgVG9vbHRpcC5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uICh0eXBlLCBlbGVtZW50LCBvcHRp\nb25zKSB7CiAgICB0aGlzLmVuYWJsZWQgICA9IHRydWUKICAgIHRoaXMudHlwZSAgICAgID0gdHlw\nZQogICAgdGhpcy4kZWxlbWVudCAgPSAkKGVsZW1lbnQpCiAgICB0aGlzLm9wdGlvbnMgICA9IHRo\naXMuZ2V0T3B0aW9ucyhvcHRpb25zKQogICAgdGhpcy4kdmlld3BvcnQgPSB0aGlzLm9wdGlvbnMu\ndmlld3BvcnQgJiYgJCh0aGlzLm9wdGlvbnMudmlld3BvcnQuc2VsZWN0b3IgfHwgdGhpcy5vcHRp\nb25zLnZpZXdwb3J0KQoKICAgIHZhciB0cmlnZ2VycyA9IHRoaXMub3B0aW9ucy50cmlnZ2VyLnNw\nbGl0KCcgJykKCiAgICBmb3IgKHZhciBpID0gdHJpZ2dlcnMubGVuZ3RoOyBpLS07KSB7CiAgICAg\nIHZhciB0cmlnZ2VyID0gdHJpZ2dlcnNbaV0KCiAgICAgIGlmICh0cmlnZ2VyID09ICdjbGljaycp\nIHsKICAgICAgICB0aGlzLiRlbGVtZW50Lm9uKCdjbGljay4nICsgdGhpcy50eXBlLCB0aGlzLm9w\ndGlvbnMuc2VsZWN0b3IsICQucHJveHkodGhpcy50b2dnbGUsIHRoaXMpKQogICAgICB9IGVsc2Ug\naWYgKHRyaWdnZXIgIT0gJ21hbnVhbCcpIHsKICAgICAgICB2YXIgZXZlbnRJbiAgPSB0cmlnZ2Vy\nID09ICdob3ZlcicgPyAnbW91c2VlbnRlcicgOiAnZm9jdXNpbicKICAgICAgICB2YXIgZXZlbnRP\ndXQgPSB0cmlnZ2VyID09ICdob3ZlcicgPyAnbW91c2VsZWF2ZScgOiAnZm9jdXNvdXQnCgogICAg\nICAgIHRoaXMuJGVsZW1lbnQub24oZXZlbnRJbiAgKyAnLicgKyB0aGlzLnR5cGUsIHRoaXMub3B0\naW9ucy5zZWxlY3RvciwgJC5wcm94eSh0aGlzLmVudGVyLCB0aGlzKSkKICAgICAgICB0aGlzLiRl\nbGVtZW50Lm9uKGV2ZW50T3V0ICsgJy4nICsgdGhpcy50eXBlLCB0aGlzLm9wdGlvbnMuc2VsZWN0\nb3IsICQucHJveHkodGhpcy5sZWF2ZSwgdGhpcykpCiAgICAgIH0KICAgIH0KCiAgICB0aGlzLm9w\ndGlvbnMuc2VsZWN0b3IgPwogICAgICAodGhpcy5fb3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCB0aGlz\nLm9wdGlvbnMsIHsgdHJpZ2dlcjogJ21hbnVhbCcsIHNlbGVjdG9yOiAnJyB9KSkgOgogICAgICB0\naGlzLmZpeFRpdGxlKCkKICB9CgogIFRvb2x0aXAucHJvdG90eXBlLmdldERlZmF1bHRzID0gZnVu\nY3Rpb24gKCkgewogICAgcmV0dXJuIFRvb2x0aXAuREVGQVVMVFMKICB9CgogIFRvb2x0aXAucHJv\ndG90eXBlLmdldE9wdGlvbnMgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgb3B0aW9ucyA9ICQu\nZXh0ZW5kKHt9LCB0aGlzLmdldERlZmF1bHRzKCksIHRoaXMuJGVsZW1lbnQuZGF0YSgpLCBvcHRp\nb25zKQoKICAgIGlmIChvcHRpb25zLmRlbGF5ICYmIHR5cGVvZiBvcHRpb25zLmRlbGF5ID09ICdu\ndW1iZXInKSB7CiAgICAgIG9wdGlvbnMuZGVsYXkgPSB7CiAgICAgICAgc2hvdzogb3B0aW9ucy5k\nZWxheSwKICAgICAgICBoaWRlOiBvcHRpb25zLmRlbGF5CiAgICAgIH0KICAgIH0KCiAgICByZXR1\ncm4gb3B0aW9ucwogIH0KCiAgVG9vbHRpcC5wcm90b3R5cGUuZ2V0RGVsZWdhdGVPcHRpb25zID0g\nZnVuY3Rpb24gKCkgewogICAgdmFyIG9wdGlvbnMgID0ge30KICAgIHZhciBkZWZhdWx0cyA9IHRo\naXMuZ2V0RGVmYXVsdHMoKQoKICAgIHRoaXMuX29wdGlvbnMgJiYgJC5lYWNoKHRoaXMuX29wdGlv\nbnMsIGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CiAgICAgIGlmIChkZWZhdWx0c1trZXldICE9IHZh\nbHVlKSBvcHRpb25zW2tleV0gPSB2YWx1ZQogICAgfSkKCiAgICByZXR1cm4gb3B0aW9ucwogIH0K\nCiAgVG9vbHRpcC5wcm90b3R5cGUuZW50ZXIgPSBmdW5jdGlvbiAob2JqKSB7CiAgICB2YXIgc2Vs\nZiA9IG9iaiBpbnN0YW5jZW9mIHRoaXMuY29uc3RydWN0b3IgPwogICAgICBvYmogOiAkKG9iai5j\ndXJyZW50VGFyZ2V0KS5kYXRhKCdicy4nICsgdGhpcy50eXBlKQoKICAgIGlmICghc2VsZikgewog\nICAgICBzZWxmID0gbmV3IHRoaXMuY29uc3RydWN0b3Iob2JqLmN1cnJlbnRUYXJnZXQsIHRoaXMu\nZ2V0RGVsZWdhdGVPcHRpb25zKCkpCiAgICAgICQob2JqLmN1cnJlbnRUYXJnZXQpLmRhdGEoJ2Jz\nLicgKyB0aGlzLnR5cGUsIHNlbGYpCiAgICB9CgogICAgY2xlYXJUaW1lb3V0KHNlbGYudGltZW91\ndCkKCiAgICBzZWxmLmhvdmVyU3RhdGUgPSAnaW4nCgogICAgaWYgKCFzZWxmLm9wdGlvbnMuZGVs\nYXkgfHwgIXNlbGYub3B0aW9ucy5kZWxheS5zaG93KSByZXR1cm4gc2VsZi5zaG93KCkKCiAgICBz\nZWxmLnRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKHNlbGYuaG92\nZXJTdGF0ZSA9PSAnaW4nKSBzZWxmLnNob3coKQogICAgfSwgc2VsZi5vcHRpb25zLmRlbGF5LnNo\nb3cpCiAgfQoKICBUb29sdGlwLnByb3RvdHlwZS5sZWF2ZSA9IGZ1bmN0aW9uIChvYmopIHsKICAg\nIHZhciBzZWxmID0gb2JqIGluc3RhbmNlb2YgdGhpcy5jb25zdHJ1Y3RvciA/CiAgICAgIG9iaiA6\nICQob2JqLmN1cnJlbnRUYXJnZXQpLmRhdGEoJ2JzLicgKyB0aGlzLnR5cGUpCgogICAgaWYgKCFz\nZWxmKSB7CiAgICAgIHNlbGYgPSBuZXcgdGhpcy5jb25zdHJ1Y3RvcihvYmouY3VycmVudFRhcmdl\ndCwgdGhpcy5nZXREZWxlZ2F0ZU9wdGlvbnMoKSkKICAgICAgJChvYmouY3VycmVudFRhcmdldCku\nZGF0YSgnYnMuJyArIHRoaXMudHlwZSwgc2VsZikKICAgIH0KCiAgICBjbGVhclRpbWVvdXQoc2Vs\nZi50aW1lb3V0KQoKICAgIHNlbGYuaG92ZXJTdGF0ZSA9ICdvdXQnCgogICAgaWYgKCFzZWxmLm9w\ndGlvbnMuZGVsYXkgfHwgIXNlbGYub3B0aW9ucy5kZWxheS5oaWRlKSByZXR1cm4gc2VsZi5oaWRl\nKCkKCiAgICBzZWxmLnRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgaWYg\nKHNlbGYuaG92ZXJTdGF0ZSA9PSAnb3V0Jykgc2VsZi5oaWRlKCkKICAgIH0sIHNlbGYub3B0aW9u\ncy5kZWxheS5oaWRlKQogIH0KCiAgVG9vbHRpcC5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uICgp\nIHsKICAgIHZhciBlID0gJC5FdmVudCgnc2hvdy5icy4nICsgdGhpcy50eXBlKQoKICAgIGlmICh0\naGlzLmhhc0NvbnRlbnQoKSAmJiB0aGlzLmVuYWJsZWQpIHsKICAgICAgdGhpcy4kZWxlbWVudC50\ncmlnZ2VyKGUpCgogICAgICB2YXIgaW5Eb20gPSAkLmNvbnRhaW5zKGRvY3VtZW50LmRvY3VtZW50\nRWxlbWVudCwgdGhpcy4kZWxlbWVudFswXSkKICAgICAgaWYgKGUuaXNEZWZhdWx0UHJldmVudGVk\nKCkgfHwgIWluRG9tKSByZXR1cm4KICAgICAgdmFyIHRoYXQgPSB0aGlzCgogICAgICB2YXIgJHRp\ncCA9IHRoaXMudGlwKCkKCiAgICAgIHZhciB0aXBJZCA9IHRoaXMuZ2V0VUlEKHRoaXMudHlwZSkK\nCiAgICAgIHRoaXMuc2V0Q29udGVudCgpCiAgICAgICR0aXAuYXR0cignaWQnLCB0aXBJZCkKICAg\nICAgdGhpcy4kZWxlbWVudC5hdHRyKCdhcmlhLWRlc2NyaWJlZGJ5JywgdGlwSWQpCgogICAgICBp\nZiAodGhpcy5vcHRpb25zLmFuaW1hdGlvbikgJHRpcC5hZGRDbGFzcygnZmFkZScpCgogICAgICB2\nYXIgcGxhY2VtZW50ID0gdHlwZW9mIHRoaXMub3B0aW9ucy5wbGFjZW1lbnQgPT0gJ2Z1bmN0aW9u\nJyA/CiAgICAgICAgdGhpcy5vcHRpb25zLnBsYWNlbWVudC5jYWxsKHRoaXMsICR0aXBbMF0sIHRo\naXMuJGVsZW1lbnRbMF0pIDoKICAgICAgICB0aGlzLm9wdGlvbnMucGxhY2VtZW50CgogICAgICB2\nYXIgYXV0b1Rva2VuID0gL1xzP2F1dG8/XHM/L2kKICAgICAgdmFyIGF1dG9QbGFjZSA9IGF1dG9U\nb2tlbi50ZXN0KHBsYWNlbWVudCkKICAgICAgaWYgKGF1dG9QbGFjZSkgcGxhY2VtZW50ID0gcGxh\nY2VtZW50LnJlcGxhY2UoYXV0b1Rva2VuLCAnJykgfHwgJ3RvcCcKCiAgICAgICR0aXAKICAgICAg\nICAuZGV0YWNoKCkKICAgICAgICAuY3NzKHsgdG9wOiAwLCBsZWZ0OiAwLCBkaXNwbGF5OiAnYmxv\nY2snIH0pCiAgICAgICAgLmFkZENsYXNzKHBsYWNlbWVudCkKICAgICAgICAuZGF0YSgnYnMuJyAr\nIHRoaXMudHlwZSwgdGhpcykKCiAgICAgIHRoaXMub3B0aW9ucy5jb250YWluZXIgPyAkdGlwLmFw\ncGVuZFRvKHRoaXMub3B0aW9ucy5jb250YWluZXIpIDogJHRpcC5pbnNlcnRBZnRlcih0aGlzLiRl\nbGVtZW50KQoKICAgICAgdmFyIHBvcyAgICAgICAgICA9IHRoaXMuZ2V0UG9zaXRpb24oKQogICAg\nICB2YXIgYWN0dWFsV2lkdGggID0gJHRpcFswXS5vZmZzZXRXaWR0aAogICAgICB2YXIgYWN0dWFs\nSGVpZ2h0ID0gJHRpcFswXS5vZmZzZXRIZWlnaHQKCiAgICAgIGlmIChhdXRvUGxhY2UpIHsKICAg\nICAgICB2YXIgb3JnUGxhY2VtZW50ID0gcGxhY2VtZW50CiAgICAgICAgdmFyICRwYXJlbnQgICAg\nICA9IHRoaXMuJGVsZW1lbnQucGFyZW50KCkKICAgICAgICB2YXIgcGFyZW50RGltICAgID0gdGhp\ncy5nZXRQb3NpdGlvbigkcGFyZW50KQoKICAgICAgICBwbGFjZW1lbnQgPSBwbGFjZW1lbnQgPT0g\nJ2JvdHRvbScgJiYgcG9zLnRvcCAgICsgcG9zLmhlaWdodCAgICAgICArIGFjdHVhbEhlaWdodCAt\nIHBhcmVudERpbS5zY3JvbGwgPiBwYXJlbnREaW0uaGVpZ2h0ID8gJ3RvcCcgICAgOgogICAgICAg\nICAgICAgICAgICAgIHBsYWNlbWVudCA9PSAndG9wJyAgICAmJiBwb3MudG9wICAgLSBwYXJlbnRE\naW0uc2Nyb2xsIC0gYWN0dWFsSGVpZ2h0IDwgMCAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgPyAnYm90dG9tJyA6CiAgICAgICAgICAgICAgICAgICAgcGxhY2VtZW50ID09ICdyaWdo\ndCcgICYmIHBvcy5yaWdodCArIGFjdHVhbFdpZHRoICAgICAgPiBwYXJlbnREaW0ud2lkdGggICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/ICdsZWZ0JyAgIDoKICAgICAgICAgICAg\nICAgICAgICBwbGFjZW1lbnQgPT0gJ2xlZnQnICAgJiYgcG9zLmxlZnQgIC0gYWN0dWFsV2lkdGgg\nICAgICA8IHBhcmVudERpbS5sZWZ0ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nID8gJ3JpZ2h0JyAgOgogICAgICAgICAgICAgICAgICAgIHBsYWNlbWVudAoKICAgICAgICAkdGlw\nCiAgICAgICAgICAucmVtb3ZlQ2xhc3Mob3JnUGxhY2VtZW50KQogICAgICAgICAgLmFkZENsYXNz\nKHBsYWNlbWVudCkKICAgICAgfQoKICAgICAgdmFyIGNhbGN1bGF0ZWRPZmZzZXQgPSB0aGlzLmdl\ndENhbGN1bGF0ZWRPZmZzZXQocGxhY2VtZW50LCBwb3MsIGFjdHVhbFdpZHRoLCBhY3R1YWxIZWln\naHQpCgogICAgICB0aGlzLmFwcGx5UGxhY2VtZW50KGNhbGN1bGF0ZWRPZmZzZXQsIHBsYWNlbWVu\ndCkKCiAgICAgIHZhciBjb21wbGV0ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGF0LiRlbGVt\nZW50LnRyaWdnZXIoJ3Nob3duLmJzLicgKyB0aGF0LnR5cGUpCiAgICAgICAgdGhhdC5ob3ZlclN0\nYXRlID0gbnVsbAogICAgICB9CgogICAgICAkLnN1cHBvcnQudHJhbnNpdGlvbiAmJiB0aGlzLiR0\naXAuaGFzQ2xhc3MoJ2ZhZGUnKSA/CiAgICAgICAgJHRpcAogICAgICAgICAgLm9uZSgnYnNUcmFu\nc2l0aW9uRW5kJywgY29tcGxldGUpCiAgICAgICAgICAuZW11bGF0ZVRyYW5zaXRpb25FbmQoMTUw\nKSA6CiAgICAgICAgY29tcGxldGUoKQogICAgfQogIH0KCiAgVG9vbHRpcC5wcm90b3R5cGUuYXBw\nbHlQbGFjZW1lbnQgPSBmdW5jdGlvbiAob2Zmc2V0LCBwbGFjZW1lbnQpIHsKICAgIHZhciAkdGlw\nICAgPSB0aGlzLnRpcCgpCiAgICB2YXIgd2lkdGggID0gJHRpcFswXS5vZmZzZXRXaWR0aAogICAg\ndmFyIGhlaWdodCA9ICR0aXBbMF0ub2Zmc2V0SGVpZ2h0CgogICAgLy8gbWFudWFsbHkgcmVhZCBt\nYXJnaW5zIGJlY2F1c2UgZ2V0Qm91bmRpbmdDbGllbnRSZWN0IGluY2x1ZGVzIGRpZmZlcmVuY2UK\nICAgIHZhciBtYXJnaW5Ub3AgPSBwYXJzZUludCgkdGlwLmNzcygnbWFyZ2luLXRvcCcpLCAxMCkK\nICAgIHZhciBtYXJnaW5MZWZ0ID0gcGFyc2VJbnQoJHRpcC5jc3MoJ21hcmdpbi1sZWZ0JyksIDEw\nKQoKICAgIC8vIHdlIG11c3QgY2hlY2sgZm9yIE5hTiBmb3IgaWUgOC85CiAgICBpZiAoaXNOYU4o\nbWFyZ2luVG9wKSkgIG1hcmdpblRvcCAgPSAwCiAgICBpZiAoaXNOYU4obWFyZ2luTGVmdCkpIG1h\ncmdpbkxlZnQgPSAwCgogICAgb2Zmc2V0LnRvcCAgPSBvZmZzZXQudG9wICArIG1hcmdpblRvcAog\nICAgb2Zmc2V0LmxlZnQgPSBvZmZzZXQubGVmdCArIG1hcmdpbkxlZnQKCiAgICAvLyAkLmZuLm9m\nZnNldCBkb2Vzbid0IHJvdW5kIHBpeGVsIHZhbHVlcwogICAgLy8gc28gd2UgdXNlIHNldE9mZnNl\ndCBkaXJlY3RseSB3aXRoIG91ciBvd24gZnVuY3Rpb24gQi0wCiAgICAkLm9mZnNldC5zZXRPZmZz\nZXQoJHRpcFswXSwgJC5leHRlbmQoewogICAgICB1c2luZzogZnVuY3Rpb24gKHByb3BzKSB7CiAg\nICAgICAgJHRpcC5jc3MoewogICAgICAgICAgdG9wOiBNYXRoLnJvdW5kKHByb3BzLnRvcCksCiAg\nICAgICAgICBsZWZ0OiBNYXRoLnJvdW5kKHByb3BzLmxlZnQpCiAgICAgICAgfSkKICAgICAgfQog\nICAgfSwgb2Zmc2V0KSwgMCkKCiAgICAkdGlwLmFkZENsYXNzKCdpbicpCgogICAgLy8gY2hlY2sg\ndG8gc2VlIGlmIHBsYWNpbmcgdGlwIGluIG5ldyBvZmZzZXQgY2F1c2VkIHRoZSB0aXAgdG8gcmVz\naXplIGl0c2VsZgogICAgdmFyIGFjdHVhbFdpZHRoICA9ICR0aXBbMF0ub2Zmc2V0V2lkdGgKICAg\nIHZhciBhY3R1YWxIZWlnaHQgPSAkdGlwWzBdLm9mZnNldEhlaWdodAoKICAgIGlmIChwbGFjZW1l\nbnQgPT0gJ3RvcCcgJiYgYWN0dWFsSGVpZ2h0ICE9IGhlaWdodCkgewogICAgICBvZmZzZXQudG9w\nID0gb2Zmc2V0LnRvcCArIGhlaWdodCAtIGFjdHVhbEhlaWdodAogICAgfQoKICAgIHZhciBkZWx0\nYSA9IHRoaXMuZ2V0Vmlld3BvcnRBZGp1c3RlZERlbHRhKHBsYWNlbWVudCwgb2Zmc2V0LCBhY3R1\nYWxXaWR0aCwgYWN0dWFsSGVpZ2h0KQoKICAgIGlmIChkZWx0YS5sZWZ0KSBvZmZzZXQubGVmdCAr\nPSBkZWx0YS5sZWZ0CiAgICBlbHNlIG9mZnNldC50b3AgKz0gZGVsdGEudG9wCgogICAgdmFyIGFy\ncm93RGVsdGEgICAgICAgICAgPSBkZWx0YS5sZWZ0ID8gZGVsdGEubGVmdCAqIDIgLSB3aWR0aCAr\nIGFjdHVhbFdpZHRoIDogZGVsdGEudG9wICogMiAtIGhlaWdodCArIGFjdHVhbEhlaWdodAogICAg\ndmFyIGFycm93UG9zaXRpb24gICAgICAgPSBkZWx0YS5sZWZ0ID8gJ2xlZnQnICAgICAgICA6ICd0\nb3AnCiAgICB2YXIgYXJyb3dPZmZzZXRQb3NpdGlvbiA9IGRlbHRhLmxlZnQgPyAnb2Zmc2V0V2lk\ndGgnIDogJ29mZnNldEhlaWdodCcKCiAgICAkdGlwLm9mZnNldChvZmZzZXQpCiAgICB0aGlzLnJl\ncGxhY2VBcnJvdyhhcnJvd0RlbHRhLCAkdGlwWzBdW2Fycm93T2Zmc2V0UG9zaXRpb25dLCBhcnJv\nd1Bvc2l0aW9uKQogIH0KCiAgVG9vbHRpcC5wcm90b3R5cGUucmVwbGFjZUFycm93ID0gZnVuY3Rp\nb24gKGRlbHRhLCBkaW1lbnNpb24sIHBvc2l0aW9uKSB7CiAgICB0aGlzLmFycm93KCkuY3NzKHBv\nc2l0aW9uLCBkZWx0YSA/ICg1MCAqICgxIC0gZGVsdGEgLyBkaW1lbnNpb24pICsgJyUnKSA6ICcn\nKQogIH0KCiAgVG9vbHRpcC5wcm90b3R5cGUuc2V0Q29udGVudCA9IGZ1bmN0aW9uICgpIHsKICAg\nIHZhciAkdGlwICA9IHRoaXMudGlwKCkKICAgIHZhciB0aXRsZSA9IHRoaXMuZ2V0VGl0bGUoKQoK\nICAgICR0aXAuZmluZCgnLnRvb2x0aXAtaW5uZXInKVt0aGlzLm9wdGlvbnMuaHRtbCA/ICdodG1s\nJyA6ICd0ZXh0J10odGl0bGUpCiAgICAkdGlwLnJlbW92ZUNsYXNzKCdmYWRlIGluIHRvcCBib3R0\nb20gbGVmdCByaWdodCcpCiAgfQoKICBUb29sdGlwLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24g\nKCkgewogICAgdmFyIHRoYXQgPSB0aGlzCiAgICB2YXIgJHRpcCA9IHRoaXMudGlwKCkKICAgIHZh\nciBlICAgID0gJC5FdmVudCgnaGlkZS5icy4nICsgdGhpcy50eXBlKQoKICAgIHRoaXMuJGVsZW1l\nbnQucmVtb3ZlQXR0cignYXJpYS1kZXNjcmliZWRieScpCgogICAgZnVuY3Rpb24gY29tcGxldGUo\nKSB7CiAgICAgIGlmICh0aGF0LmhvdmVyU3RhdGUgIT0gJ2luJykgJHRpcC5kZXRhY2goKQogICAg\nICB0aGF0LiRlbGVtZW50LnRyaWdnZXIoJ2hpZGRlbi5icy4nICsgdGhhdC50eXBlKQogICAgfQoK\nICAgIHRoaXMuJGVsZW1lbnQudHJpZ2dlcihlKQoKICAgIGlmIChlLmlzRGVmYXVsdFByZXZlbnRl\nZCgpKSByZXR1cm4KCiAgICAkdGlwLnJlbW92ZUNsYXNzKCdpbicpCgogICAgJC5zdXBwb3J0LnRy\nYW5zaXRpb24gJiYgdGhpcy4kdGlwLmhhc0NsYXNzKCdmYWRlJykgPwogICAgICAkdGlwCiAgICAg\nICAgLm9uZSgnYnNUcmFuc2l0aW9uRW5kJywgY29tcGxldGUpCiAgICAgICAgLmVtdWxhdGVUcmFu\nc2l0aW9uRW5kKDE1MCkgOgogICAgICBjb21wbGV0ZSgpCgogICAgdGhpcy5ob3ZlclN0YXRlID0g\nbnVsbAoKICAgIHJldHVybiB0aGlzCiAgfQoKICBUb29sdGlwLnByb3RvdHlwZS5maXhUaXRsZSA9\nIGZ1bmN0aW9uICgpIHsKICAgIHZhciAkZSA9IHRoaXMuJGVsZW1lbnQKICAgIGlmICgkZS5hdHRy\nKCd0aXRsZScpIHx8IHR5cGVvZiAoJGUuYXR0cignZGF0YS1vcmlnaW5hbC10aXRsZScpKSAhPSAn\nc3RyaW5nJykgewogICAgICAkZS5hdHRyKCdkYXRhLW9yaWdpbmFsLXRpdGxlJywgJGUuYXR0cign\ndGl0bGUnKSB8fCAnJykuYXR0cigndGl0bGUnLCAnJykKICAgIH0KICB9CgogIFRvb2x0aXAucHJv\ndG90eXBlLmhhc0NvbnRlbnQgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5nZXRUaXRs\nZSgpCiAgfQoKICBUb29sdGlwLnByb3RvdHlwZS5nZXRQb3NpdGlvbiA9IGZ1bmN0aW9uICgkZWxl\nbWVudCkgewogICAgJGVsZW1lbnQgICA9ICRlbGVtZW50IHx8IHRoaXMuJGVsZW1lbnQKICAgIHZh\nciBlbCAgICAgPSAkZWxlbWVudFswXQogICAgdmFyIGlzQm9keSA9IGVsLnRhZ05hbWUgPT0gJ0JP\nRFknCiAgICByZXR1cm4gJC5leHRlbmQoe30sICh0eXBlb2YgZWwuZ2V0Qm91bmRpbmdDbGllbnRS\nZWN0ID09ICdmdW5jdGlvbicpID8gZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkgOiBudWxsLCB7\nCiAgICAgIHNjcm9sbDogaXNCb2R5ID8gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRv\ncCB8fCBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcCA6ICRlbGVtZW50LnNjcm9sbFRvcCgpLAogICAg\nICB3aWR0aDogIGlzQm9keSA/ICQod2luZG93KS53aWR0aCgpICA6ICRlbGVtZW50Lm91dGVyV2lk\ndGgoKSwKICAgICAgaGVpZ2h0OiBpc0JvZHkgPyAkKHdpbmRvdykuaGVpZ2h0KCkgOiAkZWxlbWVu\ndC5vdXRlckhlaWdodCgpCiAgICB9LCBpc0JvZHkgPyB7IHRvcDogMCwgbGVmdDogMCB9IDogJGVs\nZW1lbnQub2Zmc2V0KCkpCiAgfQoKICBUb29sdGlwLnByb3RvdHlwZS5nZXRDYWxjdWxhdGVkT2Zm\nc2V0ID0gZnVuY3Rpb24gKHBsYWNlbWVudCwgcG9zLCBhY3R1YWxXaWR0aCwgYWN0dWFsSGVpZ2h0\nKSB7CiAgICByZXR1cm4gcGxhY2VtZW50ID09ICdib3R0b20nID8geyB0b3A6IHBvcy50b3AgKyBw\nb3MuaGVpZ2h0LCAgIGxlZnQ6IHBvcy5sZWZ0ICsgcG9zLndpZHRoIC8gMiAtIGFjdHVhbFdpZHRo\nIC8gMiAgfSA6CiAgICAgICAgICAgcGxhY2VtZW50ID09ICd0b3AnICAgID8geyB0b3A6IHBvcy50\nb3AgLSBhY3R1YWxIZWlnaHQsIGxlZnQ6IHBvcy5sZWZ0ICsgcG9zLndpZHRoIC8gMiAtIGFjdHVh\nbFdpZHRoIC8gMiAgfSA6CiAgICAgICAgICAgcGxhY2VtZW50ID09ICdsZWZ0JyAgID8geyB0b3A6\nIHBvcy50b3AgKyBwb3MuaGVpZ2h0IC8gMiAtIGFjdHVhbEhlaWdodCAvIDIsIGxlZnQ6IHBvcy5s\nZWZ0IC0gYWN0dWFsV2lkdGggfSA6CiAgICAgICAgLyogcGxhY2VtZW50ID09ICdyaWdodCcgKi8g\neyB0b3A6IHBvcy50b3AgKyBwb3MuaGVpZ2h0IC8gMiAtIGFjdHVhbEhlaWdodCAvIDIsIGxlZnQ6\nIHBvcy5sZWZ0ICsgcG9zLndpZHRoICAgfQoKICB9CgogIFRvb2x0aXAucHJvdG90eXBlLmdldFZp\nZXdwb3J0QWRqdXN0ZWREZWx0YSA9IGZ1bmN0aW9uIChwbGFjZW1lbnQsIHBvcywgYWN0dWFsV2lk\ndGgsIGFjdHVhbEhlaWdodCkgewogICAgdmFyIGRlbHRhID0geyB0b3A6IDAsIGxlZnQ6IDAgfQog\nICAgaWYgKCF0aGlzLiR2aWV3cG9ydCkgcmV0dXJuIGRlbHRhCgogICAgdmFyIHZpZXdwb3J0UGFk\nZGluZyA9IHRoaXMub3B0aW9ucy52aWV3cG9ydCAmJiB0aGlzLm9wdGlvbnMudmlld3BvcnQucGFk\nZGluZyB8fCAwCiAgICB2YXIgdmlld3BvcnREaW1lbnNpb25zID0gdGhpcy5nZXRQb3NpdGlvbih0\naGlzLiR2aWV3cG9ydCkKCiAgICBpZiAoL3JpZ2h0fGxlZnQvLnRlc3QocGxhY2VtZW50KSkgewog\nICAgICB2YXIgdG9wRWRnZU9mZnNldCAgICA9IHBvcy50b3AgLSB2aWV3cG9ydFBhZGRpbmcgLSB2\naWV3cG9ydERpbWVuc2lvbnMuc2Nyb2xsCiAgICAgIHZhciBib3R0b21FZGdlT2Zmc2V0ID0gcG9z\nLnRvcCArIHZpZXdwb3J0UGFkZGluZyAtIHZpZXdwb3J0RGltZW5zaW9ucy5zY3JvbGwgKyBhY3R1\nYWxIZWlnaHQKICAgICAgaWYgKHRvcEVkZ2VPZmZzZXQgPCB2aWV3cG9ydERpbWVuc2lvbnMudG9w\nKSB7IC8vIHRvcCBvdmVyZmxvdwogICAgICAgIGRlbHRhLnRvcCA9IHZpZXdwb3J0RGltZW5zaW9u\ncy50b3AgLSB0b3BFZGdlT2Zmc2V0CiAgICAgIH0gZWxzZSBpZiAoYm90dG9tRWRnZU9mZnNldCA+\nIHZpZXdwb3J0RGltZW5zaW9ucy50b3AgKyB2aWV3cG9ydERpbWVuc2lvbnMuaGVpZ2h0KSB7IC8v\nIGJvdHRvbSBvdmVyZmxvdwogICAgICAgIGRlbHRhLnRvcCA9IHZpZXdwb3J0RGltZW5zaW9ucy50\nb3AgKyB2aWV3cG9ydERpbWVuc2lvbnMuaGVpZ2h0IC0gYm90dG9tRWRnZU9mZnNldAogICAgICB9\nCiAgICB9IGVsc2UgewogICAgICB2YXIgbGVmdEVkZ2VPZmZzZXQgID0gcG9zLmxlZnQgLSB2aWV3\ncG9ydFBhZGRpbmcKICAgICAgdmFyIHJpZ2h0RWRnZU9mZnNldCA9IHBvcy5sZWZ0ICsgdmlld3Bv\ncnRQYWRkaW5nICsgYWN0dWFsV2lkdGgKICAgICAgaWYgKGxlZnRFZGdlT2Zmc2V0IDwgdmlld3Bv\ncnREaW1lbnNpb25zLmxlZnQpIHsgLy8gbGVmdCBvdmVyZmxvdwogICAgICAgIGRlbHRhLmxlZnQg\nPSB2aWV3cG9ydERpbWVuc2lvbnMubGVmdCAtIGxlZnRFZGdlT2Zmc2V0CiAgICAgIH0gZWxzZSBp\nZiAocmlnaHRFZGdlT2Zmc2V0ID4gdmlld3BvcnREaW1lbnNpb25zLndpZHRoKSB7IC8vIHJpZ2h0\nIG92ZXJmbG93CiAgICAgICAgZGVsdGEubGVmdCA9IHZpZXdwb3J0RGltZW5zaW9ucy5sZWZ0ICsg\ndmlld3BvcnREaW1lbnNpb25zLndpZHRoIC0gcmlnaHRFZGdlT2Zmc2V0CiAgICAgIH0KICAgIH0K\nCiAgICByZXR1cm4gZGVsdGEKICB9CgogIFRvb2x0aXAucHJvdG90eXBlLmdldFRpdGxlID0gZnVu\nY3Rpb24gKCkgewogICAgdmFyIHRpdGxlCiAgICB2YXIgJGUgPSB0aGlzLiRlbGVtZW50CiAgICB2\nYXIgbyAgPSB0aGlzLm9wdGlvbnMKCiAgICB0aXRsZSA9ICRlLmF0dHIoJ2RhdGEtb3JpZ2luYWwt\ndGl0bGUnKQogICAgICB8fCAodHlwZW9mIG8udGl0bGUgPT0gJ2Z1bmN0aW9uJyA/IG8udGl0bGUu\nY2FsbCgkZVswXSkgOiAgby50aXRsZSkKCiAgICByZXR1cm4gdGl0bGUKICB9CgogIFRvb2x0aXAu\ncHJvdG90eXBlLmdldFVJRCA9IGZ1bmN0aW9uIChwcmVmaXgpIHsKICAgIGRvIHByZWZpeCArPSB+\nfihNYXRoLnJhbmRvbSgpICogMTAwMDAwMCkKICAgIHdoaWxlIChkb2N1bWVudC5nZXRFbGVtZW50\nQnlJZChwcmVmaXgpKQogICAgcmV0dXJuIHByZWZpeAogIH0KCiAgVG9vbHRpcC5wcm90b3R5cGUu\ndGlwID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuICh0aGlzLiR0aXAgPSB0aGlzLiR0aXAgfHwg\nJCh0aGlzLm9wdGlvbnMudGVtcGxhdGUpKQogIH0KCiAgVG9vbHRpcC5wcm90b3R5cGUuYXJyb3cg\nPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gKHRoaXMuJGFycm93ID0gdGhpcy4kYXJyb3cgfHwg\ndGhpcy50aXAoKS5maW5kKCcudG9vbHRpcC1hcnJvdycpKQogIH0KCiAgVG9vbHRpcC5wcm90b3R5\ncGUudmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7CiAgICBpZiAoIXRoaXMuJGVsZW1lbnRbMF0ucGFy\nZW50Tm9kZSkgewogICAgICB0aGlzLmhpZGUoKQogICAgICB0aGlzLiRlbGVtZW50ID0gbnVsbAog\nICAgICB0aGlzLm9wdGlvbnMgID0gbnVsbAogICAgfQogIH0KCiAgVG9vbHRpcC5wcm90b3R5cGUu\nZW5hYmxlID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy5lbmFibGVkID0gdHJ1ZQogIH0KCiAgVG9v\nbHRpcC5wcm90b3R5cGUuZGlzYWJsZSA9IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuZW5hYmxlZCA9\nIGZhbHNlCiAgfQoKICBUb29sdGlwLnByb3RvdHlwZS50b2dnbGVFbmFibGVkID0gZnVuY3Rpb24g\nKCkgewogICAgdGhpcy5lbmFibGVkID0gIXRoaXMuZW5hYmxlZAogIH0KCiAgVG9vbHRpcC5wcm90\nb3R5cGUudG9nZ2xlID0gZnVuY3Rpb24gKGUpIHsKICAgIHZhciBzZWxmID0gdGhpcwogICAgaWYg\nKGUpIHsKICAgICAgc2VsZiA9ICQoZS5jdXJyZW50VGFyZ2V0KS5kYXRhKCdicy4nICsgdGhpcy50\neXBlKQogICAgICBpZiAoIXNlbGYpIHsKICAgICAgICBzZWxmID0gbmV3IHRoaXMuY29uc3RydWN0\nb3IoZS5jdXJyZW50VGFyZ2V0LCB0aGlzLmdldERlbGVnYXRlT3B0aW9ucygpKQogICAgICAgICQo\nZS5jdXJyZW50VGFyZ2V0KS5kYXRhKCdicy4nICsgdGhpcy50eXBlLCBzZWxmKQogICAgICB9CiAg\nICB9CgogICAgc2VsZi50aXAoKS5oYXNDbGFzcygnaW4nKSA/IHNlbGYubGVhdmUoc2VsZikgOiBz\nZWxmLmVudGVyKHNlbGYpCiAgfQoKICBUb29sdGlwLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rp\nb24gKCkgewogICAgY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dCkKICAgIHRoaXMuaGlkZSgpLiRl\nbGVtZW50Lm9mZignLicgKyB0aGlzLnR5cGUpLnJlbW92ZURhdGEoJ2JzLicgKyB0aGlzLnR5cGUp\nCiAgfQoKCiAgLy8gVE9PTFRJUCBQTFVHSU4gREVGSU5JVElPTgogIC8vID09PT09PT09PT09PT09\nPT09PT09PT09PT0KCiAgZnVuY3Rpb24gUGx1Z2luKG9wdGlvbikgewogICAgcmV0dXJuIHRoaXMu\nZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgIHZhciAkdGhpcyAgID0gJCh0aGlzKQogICAgICB2YXIg\nZGF0YSAgICA9ICR0aGlzLmRhdGEoJ2JzLnRvb2x0aXAnKQogICAgICB2YXIgb3B0aW9ucyA9IHR5\ncGVvZiBvcHRpb24gPT0gJ29iamVjdCcgJiYgb3B0aW9uCgogICAgICBpZiAoIWRhdGEgJiYgb3B0\naW9uID09ICdkZXN0cm95JykgcmV0dXJuCiAgICAgIGlmICghZGF0YSkgJHRoaXMuZGF0YSgnYnMu\ndG9vbHRpcCcsIChkYXRhID0gbmV3IFRvb2x0aXAodGhpcywgb3B0aW9ucykpKQogICAgICBpZiAo\ndHlwZW9mIG9wdGlvbiA9PSAnc3RyaW5nJykgZGF0YVtvcHRpb25dKCkKICAgIH0pCiAgfQoKICB2\nYXIgb2xkID0gJC5mbi50b29sdGlwCgogICQuZm4udG9vbHRpcCAgICAgICAgICAgICA9IFBsdWdp\nbgogICQuZm4udG9vbHRpcC5Db25zdHJ1Y3RvciA9IFRvb2x0aXAKCgogIC8vIFRPT0xUSVAgTk8g\nQ09ORkxJQ1QKICAvLyA9PT09PT09PT09PT09PT09PT09CgogICQuZm4udG9vbHRpcC5ub0NvbmZs\naWN0ID0gZnVuY3Rpb24gKCkgewogICAgJC5mbi50b29sdGlwID0gb2xkCiAgICByZXR1cm4gdGhp\ncwogIH0KCn0oalF1ZXJ5KTsKCi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogKiBCb290c3RyYXA6IHBvcG92\nZXIuanMgdjMuMi4wCiAqIGh0dHA6Ly9nZXRib290c3RyYXAuY29tL2phdmFzY3JpcHQvI3BvcG92\nZXJzCiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PQogKiBDb3B5cmlnaHQgMjAxMS0yMDE0IFR3aXR0ZXIsIElu\nYy4KICogTGljZW5zZWQgdW5kZXIgTUlUIChodHRwczovL2dpdGh1Yi5jb20vdHdicy9ib290c3Ry\nYXAvYmxvYi9tYXN0ZXIvTElDRU5TRSkKICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCgoKK2Z1bmN0aW9u\nICgkKSB7CiAgJ3VzZSBzdHJpY3QnOwoKICAvLyBQT1BPVkVSIFBVQkxJQyBDTEFTUyBERUZJTklU\nSU9OCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKICB2YXIgUG9wb3ZlciA9\nIGZ1bmN0aW9uIChlbGVtZW50LCBvcHRpb25zKSB7CiAgICB0aGlzLmluaXQoJ3BvcG92ZXInLCBl\nbGVtZW50LCBvcHRpb25zKQogIH0KCiAgaWYgKCEkLmZuLnRvb2x0aXApIHRocm93IG5ldyBFcnJv\ncignUG9wb3ZlciByZXF1aXJlcyB0b29sdGlwLmpzJykKCiAgUG9wb3Zlci5WRVJTSU9OICA9ICcz\nLjIuMCcKCiAgUG9wb3Zlci5ERUZBVUxUUyA9ICQuZXh0ZW5kKHt9LCAkLmZuLnRvb2x0aXAuQ29u\nc3RydWN0b3IuREVGQVVMVFMsIHsKICAgIHBsYWNlbWVudDogJ3JpZ2h0JywKICAgIHRyaWdnZXI6\nICdjbGljaycsCiAgICBjb250ZW50OiAnJywKICAgIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz0icG9w\nb3ZlciIgcm9sZT0idG9vbHRpcCI+PGRpdiBjbGFzcz0iYXJyb3ciPjwvZGl2PjxoMyBjbGFzcz0i\ncG9wb3Zlci10aXRsZSI+PC9oMz48ZGl2IGNsYXNzPSJwb3BvdmVyLWNvbnRlbnQiPjwvZGl2Pjwv\nZGl2PicKICB9KQoKCiAgLy8gTk9URTogUE9QT1ZFUiBFWFRFTkRTIHRvb2x0aXAuanMKICAvLyA9\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKICBQb3BvdmVyLnByb3RvdHlwZSA9ICQu\nZXh0ZW5kKHt9LCAkLmZuLnRvb2x0aXAuQ29uc3RydWN0b3IucHJvdG90eXBlKQoKICBQb3BvdmVy\nLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFBvcG92ZXIKCiAgUG9wb3Zlci5wcm90b3R5cGUuZ2V0\nRGVmYXVsdHMgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gUG9wb3Zlci5ERUZBVUxUUwogIH0K\nCiAgUG9wb3Zlci5wcm90b3R5cGUuc2V0Q29udGVudCA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciAk\ndGlwICAgID0gdGhpcy50aXAoKQogICAgdmFyIHRpdGxlICAgPSB0aGlzLmdldFRpdGxlKCkKICAg\nIHZhciBjb250ZW50ID0gdGhpcy5nZXRDb250ZW50KCkKCiAgICAkdGlwLmZpbmQoJy5wb3BvdmVy\nLXRpdGxlJylbdGhpcy5vcHRpb25zLmh0bWwgPyAnaHRtbCcgOiAndGV4dCddKHRpdGxlKQogICAg\nJHRpcC5maW5kKCcucG9wb3Zlci1jb250ZW50JykuZW1wdHkoKVsgLy8gd2UgdXNlIGFwcGVuZCBm\nb3IgaHRtbCBvYmplY3RzIHRvIG1haW50YWluIGpzIGV2ZW50cwogICAgICB0aGlzLm9wdGlvbnMu\naHRtbCA/ICh0eXBlb2YgY29udGVudCA9PSAnc3RyaW5nJyA/ICdodG1sJyA6ICdhcHBlbmQnKSA6\nICd0ZXh0JwogICAgXShjb250ZW50KQoKICAgICR0aXAucmVtb3ZlQ2xhc3MoJ2ZhZGUgdG9wIGJv\ndHRvbSBsZWZ0IHJpZ2h0IGluJykKCiAgICAvLyBJRTggZG9lc24ndCBhY2NlcHQgaGlkaW5nIHZp\nYSB0aGUgYDplbXB0eWAgcHNldWRvIHNlbGVjdG9yLCB3ZSBoYXZlIHRvIGRvCiAgICAvLyB0aGlz\nIG1hbnVhbGx5IGJ5IGNoZWNraW5nIHRoZSBjb250ZW50cy4KICAgIGlmICghJHRpcC5maW5kKCcu\ncG9wb3Zlci10aXRsZScpLmh0bWwoKSkgJHRpcC5maW5kKCcucG9wb3Zlci10aXRsZScpLmhpZGUo\nKQogIH0KCiAgUG9wb3Zlci5wcm90b3R5cGUuaGFzQ29udGVudCA9IGZ1bmN0aW9uICgpIHsKICAg\nIHJldHVybiB0aGlzLmdldFRpdGxlKCkgfHwgdGhpcy5nZXRDb250ZW50KCkKICB9CgogIFBvcG92\nZXIucHJvdG90eXBlLmdldENvbnRlbnQgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgJGUgPSB0aGlz\nLiRlbGVtZW50CiAgICB2YXIgbyAgPSB0aGlzLm9wdGlvbnMKCiAgICByZXR1cm4gJGUuYXR0cign\nZGF0YS1jb250ZW50JykKICAgICAgfHwgKHR5cGVvZiBvLmNvbnRlbnQgPT0gJ2Z1bmN0aW9uJyA/\nCiAgICAgICAgICAgIG8uY29udGVudC5jYWxsKCRlWzBdKSA6CiAgICAgICAgICAgIG8uY29udGVu\ndCkKICB9CgogIFBvcG92ZXIucHJvdG90eXBlLmFycm93ID0gZnVuY3Rpb24gKCkgewogICAgcmV0\ndXJuICh0aGlzLiRhcnJvdyA9IHRoaXMuJGFycm93IHx8IHRoaXMudGlwKCkuZmluZCgnLmFycm93\nJykpCiAgfQoKICBQb3BvdmVyLnByb3RvdHlwZS50aXAgPSBmdW5jdGlvbiAoKSB7CiAgICBpZiAo\nIXRoaXMuJHRpcCkgdGhpcy4kdGlwID0gJCh0aGlzLm9wdGlvbnMudGVtcGxhdGUpCiAgICByZXR1\ncm4gdGhpcy4kdGlwCiAgfQoKCiAgLy8gUE9QT1ZFUiBQTFVHSU4gREVGSU5JVElPTgogIC8vID09\nPT09PT09PT09PT09PT09PT09PT09PT0KCiAgZnVuY3Rpb24gUGx1Z2luKG9wdGlvbikgewogICAg\ncmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgIHZhciAkdGhpcyAgID0gJCh0aGlz\nKQogICAgICB2YXIgZGF0YSAgICA9ICR0aGlzLmRhdGEoJ2JzLnBvcG92ZXInKQogICAgICB2YXIg\nb3B0aW9ucyA9IHR5cGVvZiBvcHRpb24gPT0gJ29iamVjdCcgJiYgb3B0aW9uCgogICAgICBpZiAo\nIWRhdGEgJiYgb3B0aW9uID09ICdkZXN0cm95JykgcmV0dXJuCiAgICAgIGlmICghZGF0YSkgJHRo\naXMuZGF0YSgnYnMucG9wb3ZlcicsIChkYXRhID0gbmV3IFBvcG92ZXIodGhpcywgb3B0aW9ucykp\nKQogICAgICBpZiAodHlwZW9mIG9wdGlvbiA9PSAnc3RyaW5nJykgZGF0YVtvcHRpb25dKCkKICAg\nIH0pCiAgfQoKICB2YXIgb2xkID0gJC5mbi5wb3BvdmVyCgogICQuZm4ucG9wb3ZlciAgICAgICAg\nICAgICA9IFBsdWdpbgogICQuZm4ucG9wb3Zlci5Db25zdHJ1Y3RvciA9IFBvcG92ZXIKCgogIC8v\nIFBPUE9WRVIgTk8gQ09ORkxJQ1QKICAvLyA9PT09PT09PT09PT09PT09PT09CgogICQuZm4ucG9w\nb3Zlci5ub0NvbmZsaWN0ID0gZnVuY3Rpb24gKCkgewogICAgJC5mbi5wb3BvdmVyID0gb2xkCiAg\nICByZXR1cm4gdGhpcwogIH0KCn0oalF1ZXJ5KTsKCi8qID09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogKiBCb290\nc3RyYXA6IHNjcm9sbHNweS5qcyB2My4yLjAKICogaHR0cDovL2dldGJvb3RzdHJhcC5jb20vamF2\nYXNjcmlwdC8jc2Nyb2xsc3B5CiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogKiBDb3B5cmlnaHQgMjAxMS0y\nMDE0IFR3aXR0ZXIsIEluYy4KICogTGljZW5zZWQgdW5kZXIgTUlUIChodHRwczovL2dpdGh1Yi5j\nb20vdHdicy9ib290c3RyYXAvYmxvYi9tYXN0ZXIvTElDRU5TRSkKICogPT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nICovCgoKK2Z1bmN0aW9uICgkKSB7CiAgJ3VzZSBzdHJpY3QnOwoKICAvLyBTQ1JPTExTUFkgQ0xB\nU1MgREVGSU5JVElPTgogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09CgogIGZ1bmN0aW9u\nIFNjcm9sbFNweShlbGVtZW50LCBvcHRpb25zKSB7CiAgICB2YXIgcHJvY2VzcyAgPSAkLnByb3h5\nKHRoaXMucHJvY2VzcywgdGhpcykKCiAgICB0aGlzLiRib2R5ICAgICAgICAgID0gJCgnYm9keScp\nCiAgICB0aGlzLiRzY3JvbGxFbGVtZW50ID0gJChlbGVtZW50KS5pcygnYm9keScpID8gJCh3aW5k\nb3cpIDogJChlbGVtZW50KQogICAgdGhpcy5vcHRpb25zICAgICAgICA9ICQuZXh0ZW5kKHt9LCBT\nY3JvbGxTcHkuREVGQVVMVFMsIG9wdGlvbnMpCiAgICB0aGlzLnNlbGVjdG9yICAgICAgID0gKHRo\naXMub3B0aW9ucy50YXJnZXQgfHwgJycpICsgJyAubmF2IGxpID4gYScKICAgIHRoaXMub2Zmc2V0\ncyAgICAgICAgPSBbXQogICAgdGhpcy50YXJnZXRzICAgICAgICA9IFtdCiAgICB0aGlzLmFjdGl2\nZVRhcmdldCAgID0gbnVsbAogICAgdGhpcy5zY3JvbGxIZWlnaHQgICA9IDAKCiAgICB0aGlzLiRz\nY3JvbGxFbGVtZW50Lm9uKCdzY3JvbGwuYnMuc2Nyb2xsc3B5JywgcHJvY2VzcykKICAgIHRoaXMu\ncmVmcmVzaCgpCiAgICB0aGlzLnByb2Nlc3MoKQogIH0KCiAgU2Nyb2xsU3B5LlZFUlNJT04gID0g\nJzMuMi4wJwoKICBTY3JvbGxTcHkuREVGQVVMVFMgPSB7CiAgICBvZmZzZXQ6IDEwCiAgfQoKICBT\nY3JvbGxTcHkucHJvdG90eXBlLmdldFNjcm9sbEhlaWdodCA9IGZ1bmN0aW9uICgpIHsKICAgIHJl\ndHVybiB0aGlzLiRzY3JvbGxFbGVtZW50WzBdLnNjcm9sbEhlaWdodCB8fCBNYXRoLm1heCh0aGlz\nLiRib2R5WzBdLnNjcm9sbEhlaWdodCwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbEhl\naWdodCkKICB9CgogIFNjcm9sbFNweS5wcm90b3R5cGUucmVmcmVzaCA9IGZ1bmN0aW9uICgpIHsK\nICAgIHZhciBvZmZzZXRNZXRob2QgPSAnb2Zmc2V0JwogICAgdmFyIG9mZnNldEJhc2UgICA9IDAK\nCiAgICBpZiAoISQuaXNXaW5kb3codGhpcy4kc2Nyb2xsRWxlbWVudFswXSkpIHsKICAgICAgb2Zm\nc2V0TWV0aG9kID0gJ3Bvc2l0aW9uJwogICAgICBvZmZzZXRCYXNlICAgPSB0aGlzLiRzY3JvbGxF\nbGVtZW50LnNjcm9sbFRvcCgpCiAgICB9CgogICAgdGhpcy5vZmZzZXRzID0gW10KICAgIHRoaXMu\ndGFyZ2V0cyA9IFtdCiAgICB0aGlzLnNjcm9sbEhlaWdodCA9IHRoaXMuZ2V0U2Nyb2xsSGVpZ2h0\nKCkKCiAgICB2YXIgc2VsZiAgICAgPSB0aGlzCgogICAgdGhpcy4kYm9keQogICAgICAuZmluZCh0\naGlzLnNlbGVjdG9yKQogICAgICAubWFwKGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgJGVsICAg\nPSAkKHRoaXMpCiAgICAgICAgdmFyIGhyZWYgID0gJGVsLmRhdGEoJ3RhcmdldCcpIHx8ICRlbC5h\ndHRyKCdocmVmJykKICAgICAgICB2YXIgJGhyZWYgPSAvXiMuLy50ZXN0KGhyZWYpICYmICQoaHJl\nZikKCiAgICAgICAgcmV0dXJuICgkaHJlZgogICAgICAgICAgJiYgJGhyZWYubGVuZ3RoCiAgICAg\nICAgICAmJiAkaHJlZi5pcygnOnZpc2libGUnKQogICAgICAgICAgJiYgW1skaHJlZltvZmZzZXRN\nZXRob2RdKCkudG9wICsgb2Zmc2V0QmFzZSwgaHJlZl1dKSB8fCBudWxsCiAgICAgIH0pCiAgICAg\nIC5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7IHJldHVybiBhWzBdIC0gYlswXSB9KQogICAgICAuZWFj\naChmdW5jdGlvbiAoKSB7CiAgICAgICAgc2VsZi5vZmZzZXRzLnB1c2godGhpc1swXSkKICAgICAg\nICBzZWxmLnRhcmdldHMucHVzaCh0aGlzWzFdKQogICAgICB9KQogIH0KCiAgU2Nyb2xsU3B5LnBy\nb3RvdHlwZS5wcm9jZXNzID0gZnVuY3Rpb24gKCkgewogICAgdmFyIHNjcm9sbFRvcCAgICA9IHRo\naXMuJHNjcm9sbEVsZW1lbnQuc2Nyb2xsVG9wKCkgKyB0aGlzLm9wdGlvbnMub2Zmc2V0CiAgICB2\nYXIgc2Nyb2xsSGVpZ2h0ID0gdGhpcy5nZXRTY3JvbGxIZWlnaHQoKQogICAgdmFyIG1heFNjcm9s\nbCAgICA9IHRoaXMub3B0aW9ucy5vZmZzZXQgKyBzY3JvbGxIZWlnaHQgLSB0aGlzLiRzY3JvbGxF\nbGVtZW50LmhlaWdodCgpCiAgICB2YXIgb2Zmc2V0cyAgICAgID0gdGhpcy5vZmZzZXRzCiAgICB2\nYXIgdGFyZ2V0cyAgICAgID0gdGhpcy50YXJnZXRzCiAgICB2YXIgYWN0aXZlVGFyZ2V0ID0gdGhp\ncy5hY3RpdmVUYXJnZXQKICAgIHZhciBpCgogICAgaWYgKHRoaXMuc2Nyb2xsSGVpZ2h0ICE9IHNj\ncm9sbEhlaWdodCkgewogICAgICB0aGlzLnJlZnJlc2goKQogICAgfQoKICAgIGlmIChzY3JvbGxU\nb3AgPj0gbWF4U2Nyb2xsKSB7CiAgICAgIHJldHVybiBhY3RpdmVUYXJnZXQgIT0gKGkgPSB0YXJn\nZXRzW3RhcmdldHMubGVuZ3RoIC0gMV0pICYmIHRoaXMuYWN0aXZhdGUoaSkKICAgIH0KCiAgICBp\nZiAoYWN0aXZlVGFyZ2V0ICYmIHNjcm9sbFRvcCA8PSBvZmZzZXRzWzBdKSB7CiAgICAgIHJldHVy\nbiBhY3RpdmVUYXJnZXQgIT0gKGkgPSB0YXJnZXRzWzBdKSAmJiB0aGlzLmFjdGl2YXRlKGkpCiAg\nICB9CgogICAgZm9yIChpID0gb2Zmc2V0cy5sZW5ndGg7IGktLTspIHsKICAgICAgYWN0aXZlVGFy\nZ2V0ICE9IHRhcmdldHNbaV0KICAgICAgICAmJiBzY3JvbGxUb3AgPj0gb2Zmc2V0c1tpXQogICAg\nICAgICYmICghb2Zmc2V0c1tpICsgMV0gfHwgc2Nyb2xsVG9wIDw9IG9mZnNldHNbaSArIDFdKQog\nICAgICAgICYmIHRoaXMuYWN0aXZhdGUodGFyZ2V0c1tpXSkKICAgIH0KICB9CgogIFNjcm9sbFNw\neS5wcm90b3R5cGUuYWN0aXZhdGUgPSBmdW5jdGlvbiAodGFyZ2V0KSB7CiAgICB0aGlzLmFjdGl2\nZVRhcmdldCA9IHRhcmdldAoKICAgICQodGhpcy5zZWxlY3RvcikKICAgICAgLnBhcmVudHNVbnRp\nbCh0aGlzLm9wdGlvbnMudGFyZ2V0LCAnLmFjdGl2ZScpCiAgICAgIC5yZW1vdmVDbGFzcygnYWN0\naXZlJykKCiAgICB2YXIgc2VsZWN0b3IgPSB0aGlzLnNlbGVjdG9yICsKICAgICAgICAnW2RhdGEt\ndGFyZ2V0PSInICsgdGFyZ2V0ICsgJyJdLCcgKwogICAgICAgIHRoaXMuc2VsZWN0b3IgKyAnW2hy\nZWY9IicgKyB0YXJnZXQgKyAnIl0nCgogICAgdmFyIGFjdGl2ZSA9ICQoc2VsZWN0b3IpCiAgICAg\nIC5wYXJlbnRzKCdsaScpCiAgICAgIC5hZGRDbGFzcygnYWN0aXZlJykKCiAgICBpZiAoYWN0aXZl\nLnBhcmVudCgnLmRyb3Bkb3duLW1lbnUnKS5sZW5ndGgpIHsKICAgICAgYWN0aXZlID0gYWN0aXZl\nCiAgICAgICAgLmNsb3Nlc3QoJ2xpLmRyb3Bkb3duJykKICAgICAgICAuYWRkQ2xhc3MoJ2FjdGl2\nZScpCiAgICB9CgogICAgYWN0aXZlLnRyaWdnZXIoJ2FjdGl2YXRlLmJzLnNjcm9sbHNweScpCiAg\nfQoKCiAgLy8gU0NST0xMU1BZIFBMVUdJTiBERUZJTklUSU9OCiAgLy8gPT09PT09PT09PT09PT09\nPT09PT09PT09PT09CgogIGZ1bmN0aW9uIFBsdWdpbihvcHRpb24pIHsKICAgIHJldHVybiB0aGlz\nLmVhY2goZnVuY3Rpb24gKCkgewogICAgICB2YXIgJHRoaXMgICA9ICQodGhpcykKICAgICAgdmFy\nIGRhdGEgICAgPSAkdGhpcy5kYXRhKCdicy5zY3JvbGxzcHknKQogICAgICB2YXIgb3B0aW9ucyA9\nIHR5cGVvZiBvcHRpb24gPT0gJ29iamVjdCcgJiYgb3B0aW9uCgogICAgICBpZiAoIWRhdGEpICR0\naGlzLmRhdGEoJ2JzLnNjcm9sbHNweScsIChkYXRhID0gbmV3IFNjcm9sbFNweSh0aGlzLCBvcHRp\nb25zKSkpCiAgICAgIGlmICh0eXBlb2Ygb3B0aW9uID09ICdzdHJpbmcnKSBkYXRhW29wdGlvbl0o\nKQogICAgfSkKICB9CgogIHZhciBvbGQgPSAkLmZuLnNjcm9sbHNweQoKICAkLmZuLnNjcm9sbHNw\neSAgICAgICAgICAgICA9IFBsdWdpbgogICQuZm4uc2Nyb2xsc3B5LkNvbnN0cnVjdG9yID0gU2Ny\nb2xsU3B5CgoKICAvLyBTQ1JPTExTUFkgTk8gQ09ORkxJQ1QKICAvLyA9PT09PT09PT09PT09PT09\nPT09PT0KCiAgJC5mbi5zY3JvbGxzcHkubm9Db25mbGljdCA9IGZ1bmN0aW9uICgpIHsKICAgICQu\nZm4uc2Nyb2xsc3B5ID0gb2xkCiAgICByZXR1cm4gdGhpcwogIH0KCgogIC8vIFNDUk9MTFNQWSBE\nQVRBLUFQSQogIC8vID09PT09PT09PT09PT09PT09PQoKICAkKHdpbmRvdykub24oJ2xvYWQuYnMu\nc2Nyb2xsc3B5LmRhdGEtYXBpJywgZnVuY3Rpb24gKCkgewogICAgJCgnW2RhdGEtc3B5PSJzY3Jv\nbGwiXScpLmVhY2goZnVuY3Rpb24gKCkgewogICAgICB2YXIgJHNweSA9ICQodGhpcykKICAgICAg\nUGx1Z2luLmNhbGwoJHNweSwgJHNweS5kYXRhKCkpCiAgICB9KQogIH0pCgp9KGpRdWVyeSk7Cgov\nKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT0KICogQm9vdHN0cmFwOiB0YWIuanMgdjMuMi4wCiAqIGh0dHA6Ly9n\nZXRib290c3RyYXAuY29tL2phdmFzY3JpcHQvI3RhYnMKICogPT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAqIENv\ncHlyaWdodCAyMDExLTIwMTQgVHdpdHRlciwgSW5jLgogKiBMaWNlbnNlZCB1bmRlciBNSVQgKGh0\ndHBzOi8vZ2l0aHViLmNvbS90d2JzL2Jvb3RzdHJhcC9ibG9iL21hc3Rlci9MSUNFTlNFKQogKiA9\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT0gKi8KCgorZnVuY3Rpb24gKCQpIHsKICAndXNlIHN0cmljdCc7CgogIC8v\nIFRBQiBDTEFTUyBERUZJTklUSU9OCiAgLy8gPT09PT09PT09PT09PT09PT09PT0KCiAgdmFyIFRh\nYiA9IGZ1bmN0aW9uIChlbGVtZW50KSB7CiAgICB0aGlzLmVsZW1lbnQgPSAkKGVsZW1lbnQpCiAg\nfQoKICBUYWIuVkVSU0lPTiA9ICczLjIuMCcKCiAgVGFiLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rp\nb24gKCkgewogICAgdmFyICR0aGlzICAgID0gdGhpcy5lbGVtZW50CiAgICB2YXIgJHVsICAgICAg\nPSAkdGhpcy5jbG9zZXN0KCd1bDpub3QoLmRyb3Bkb3duLW1lbnUpJykKICAgIHZhciBzZWxlY3Rv\nciA9ICR0aGlzLmRhdGEoJ3RhcmdldCcpCgogICAgaWYgKCFzZWxlY3RvcikgewogICAgICBzZWxl\nY3RvciA9ICR0aGlzLmF0dHIoJ2hyZWYnKQogICAgICBzZWxlY3RvciA9IHNlbGVjdG9yICYmIHNl\nbGVjdG9yLnJlcGxhY2UoLy4qKD89I1teXHNdKiQpLywgJycpIC8vIHN0cmlwIGZvciBpZTcKICAg\nIH0KCiAgICBpZiAoJHRoaXMucGFyZW50KCdsaScpLmhhc0NsYXNzKCdhY3RpdmUnKSkgcmV0dXJu\nCgogICAgdmFyIHByZXZpb3VzID0gJHVsLmZpbmQoJy5hY3RpdmU6bGFzdCBhJylbMF0KICAgIHZh\nciBlICAgICAgICA9ICQuRXZlbnQoJ3Nob3cuYnMudGFiJywgewogICAgICByZWxhdGVkVGFyZ2V0\nOiBwcmV2aW91cwogICAgfSkKCiAgICAkdGhpcy50cmlnZ2VyKGUpCgogICAgaWYgKGUuaXNEZWZh\ndWx0UHJldmVudGVkKCkpIHJldHVybgoKICAgIHZhciAkdGFyZ2V0ID0gJChzZWxlY3RvcikKCiAg\nICB0aGlzLmFjdGl2YXRlKCR0aGlzLmNsb3Nlc3QoJ2xpJyksICR1bCkKICAgIHRoaXMuYWN0aXZh\ndGUoJHRhcmdldCwgJHRhcmdldC5wYXJlbnQoKSwgZnVuY3Rpb24gKCkgewogICAgICAkdGhpcy50\ncmlnZ2VyKHsKICAgICAgICB0eXBlOiAnc2hvd24uYnMudGFiJywKICAgICAgICByZWxhdGVkVGFy\nZ2V0OiBwcmV2aW91cwogICAgICB9KQogICAgfSkKICB9CgogIFRhYi5wcm90b3R5cGUuYWN0aXZh\ndGUgPSBmdW5jdGlvbiAoZWxlbWVudCwgY29udGFpbmVyLCBjYWxsYmFjaykgewogICAgdmFyICRh\nY3RpdmUgICAgPSBjb250YWluZXIuZmluZCgnPiAuYWN0aXZlJykKICAgIHZhciB0cmFuc2l0aW9u\nID0gY2FsbGJhY2sKICAgICAgJiYgJC5zdXBwb3J0LnRyYW5zaXRpb24KICAgICAgJiYgJGFjdGl2\nZS5oYXNDbGFzcygnZmFkZScpCgogICAgZnVuY3Rpb24gbmV4dCgpIHsKICAgICAgJGFjdGl2ZQog\nICAgICAgIC5yZW1vdmVDbGFzcygnYWN0aXZlJykKICAgICAgICAuZmluZCgnPiAuZHJvcGRvd24t\nbWVudSA+IC5hY3RpdmUnKQogICAgICAgIC5yZW1vdmVDbGFzcygnYWN0aXZlJykKCiAgICAgIGVs\nZW1lbnQuYWRkQ2xhc3MoJ2FjdGl2ZScpCgogICAgICBpZiAodHJhbnNpdGlvbikgewogICAgICAg\nIGVsZW1lbnRbMF0ub2Zmc2V0V2lkdGggLy8gcmVmbG93IGZvciB0cmFuc2l0aW9uCiAgICAgICAg\nZWxlbWVudC5hZGRDbGFzcygnaW4nKQogICAgICB9IGVsc2UgewogICAgICAgIGVsZW1lbnQucmVt\nb3ZlQ2xhc3MoJ2ZhZGUnKQogICAgICB9CgogICAgICBpZiAoZWxlbWVudC5wYXJlbnQoJy5kcm9w\nZG93bi1tZW51JykpIHsKICAgICAgICBlbGVtZW50LmNsb3Nlc3QoJ2xpLmRyb3Bkb3duJykuYWRk\nQ2xhc3MoJ2FjdGl2ZScpCiAgICAgIH0KCiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKCkKICAg\nIH0KCiAgICB0cmFuc2l0aW9uID8KICAgICAgJGFjdGl2ZQogICAgICAgIC5vbmUoJ2JzVHJhbnNp\ndGlvbkVuZCcsIG5leHQpCiAgICAgICAgLmVtdWxhdGVUcmFuc2l0aW9uRW5kKDE1MCkgOgogICAg\nICBuZXh0KCkKCiAgICAkYWN0aXZlLnJlbW92ZUNsYXNzKCdpbicpCiAgfQoKCiAgLy8gVEFCIFBM\nVUdJTiBERUZJTklUSU9OCiAgLy8gPT09PT09PT09PT09PT09PT09PT09CgogIGZ1bmN0aW9uIFBs\ndWdpbihvcHRpb24pIHsKICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgewogICAgICB2\nYXIgJHRoaXMgPSAkKHRoaXMpCiAgICAgIHZhciBkYXRhICA9ICR0aGlzLmRhdGEoJ2JzLnRhYicp\nCgogICAgICBpZiAoIWRhdGEpICR0aGlzLmRhdGEoJ2JzLnRhYicsIChkYXRhID0gbmV3IFRhYih0\naGlzKSkpCiAgICAgIGlmICh0eXBlb2Ygb3B0aW9uID09ICdzdHJpbmcnKSBkYXRhW29wdGlvbl0o\nKQogICAgfSkKICB9CgogIHZhciBvbGQgPSAkLmZuLnRhYgoKICAkLmZuLnRhYiAgICAgICAgICAg\nICA9IFBsdWdpbgogICQuZm4udGFiLkNvbnN0cnVjdG9yID0gVGFiCgoKICAvLyBUQUIgTk8gQ09O\nRkxJQ1QKICAvLyA9PT09PT09PT09PT09PT0KCiAgJC5mbi50YWIubm9Db25mbGljdCA9IGZ1bmN0\naW9uICgpIHsKICAgICQuZm4udGFiID0gb2xkCiAgICByZXR1cm4gdGhpcwogIH0KCgogIC8vIFRB\nQiBEQVRBLUFQSQogIC8vID09PT09PT09PT09PQoKICAkKGRvY3VtZW50KS5vbignY2xpY2suYnMu\ndGFiLmRhdGEtYXBpJywgJ1tkYXRhLXRvZ2dsZT0idGFiIl0sIFtkYXRhLXRvZ2dsZT0icGlsbCJd\nJywgZnVuY3Rpb24gKGUpIHsKICAgIGUucHJldmVudERlZmF1bHQoKQogICAgUGx1Z2luLmNhbGwo\nJCh0aGlzKSwgJ3Nob3cnKQogIH0pCgp9KGpRdWVyeSk7CgovKiA9PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICog\nQm9vdHN0cmFwOiBhZmZpeC5qcyB2My4yLjAKICogaHR0cDovL2dldGJvb3RzdHJhcC5jb20vamF2\nYXNjcmlwdC8jYWZmaXgKICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAqIENvcHlyaWdodCAyMDExLTIwMTQg\nVHdpdHRlciwgSW5jLgogKiBMaWNlbnNlZCB1bmRlciBNSVQgKGh0dHBzOi8vZ2l0aHViLmNvbS90\nd2JzL2Jvb3RzdHJhcC9ibG9iL21hc3Rlci9MSUNFTlNFKQogKiA9PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8K\nCgorZnVuY3Rpb24gKCQpIHsKICAndXNlIHN0cmljdCc7CgogIC8vIEFGRklYIENMQVNTIERFRklO\nSVRJT04KICAvLyA9PT09PT09PT09PT09PT09PT09PT09CgogIHZhciBBZmZpeCA9IGZ1bmN0aW9u\nIChlbGVtZW50LCBvcHRpb25zKSB7CiAgICB0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgQWZm\naXguREVGQVVMVFMsIG9wdGlvbnMpCgogICAgdGhpcy4kdGFyZ2V0ID0gJCh0aGlzLm9wdGlvbnMu\ndGFyZ2V0KQogICAgICAub24oJ3Njcm9sbC5icy5hZmZpeC5kYXRhLWFwaScsICQucHJveHkodGhp\ncy5jaGVja1Bvc2l0aW9uLCB0aGlzKSkKICAgICAgLm9uKCdjbGljay5icy5hZmZpeC5kYXRhLWFw\naScsICAkLnByb3h5KHRoaXMuY2hlY2tQb3NpdGlvbldpdGhFdmVudExvb3AsIHRoaXMpKQoKICAg\nIHRoaXMuJGVsZW1lbnQgICAgID0gJChlbGVtZW50KQogICAgdGhpcy5hZmZpeGVkICAgICAgPQog\nICAgdGhpcy51bnBpbiAgICAgICAgPQogICAgdGhpcy5waW5uZWRPZmZzZXQgPSBudWxsCgogICAg\ndGhpcy5jaGVja1Bvc2l0aW9uKCkKICB9CgogIEFmZml4LlZFUlNJT04gID0gJzMuMi4wJwoKICBB\nZmZpeC5SRVNFVCAgICA9ICdhZmZpeCBhZmZpeC10b3AgYWZmaXgtYm90dG9tJwoKICBBZmZpeC5E\nRUZBVUxUUyA9IHsKICAgIG9mZnNldDogMCwKICAgIHRhcmdldDogd2luZG93CiAgfQoKICBBZmZp\neC5wcm90b3R5cGUuZ2V0UGlubmVkT2Zmc2V0ID0gZnVuY3Rpb24gKCkgewogICAgaWYgKHRoaXMu\ncGlubmVkT2Zmc2V0KSByZXR1cm4gdGhpcy5waW5uZWRPZmZzZXQKICAgIHRoaXMuJGVsZW1lbnQu\ncmVtb3ZlQ2xhc3MoQWZmaXguUkVTRVQpLmFkZENsYXNzKCdhZmZpeCcpCiAgICB2YXIgc2Nyb2xs\nVG9wID0gdGhpcy4kdGFyZ2V0LnNjcm9sbFRvcCgpCiAgICB2YXIgcG9zaXRpb24gID0gdGhpcy4k\nZWxlbWVudC5vZmZzZXQoKQogICAgcmV0dXJuICh0aGlzLnBpbm5lZE9mZnNldCA9IHBvc2l0aW9u\nLnRvcCAtIHNjcm9sbFRvcCkKICB9CgogIEFmZml4LnByb3RvdHlwZS5jaGVja1Bvc2l0aW9uV2l0\naEV2ZW50TG9vcCA9IGZ1bmN0aW9uICgpIHsKICAgIHNldFRpbWVvdXQoJC5wcm94eSh0aGlzLmNo\nZWNrUG9zaXRpb24sIHRoaXMpLCAxKQogIH0KCiAgQWZmaXgucHJvdG90eXBlLmNoZWNrUG9zaXRp\nb24gPSBmdW5jdGlvbiAoKSB7CiAgICBpZiAoIXRoaXMuJGVsZW1lbnQuaXMoJzp2aXNpYmxlJykp\nIHJldHVybgoKICAgIHZhciBzY3JvbGxIZWlnaHQgPSAkKGRvY3VtZW50KS5oZWlnaHQoKQogICAg\ndmFyIHNjcm9sbFRvcCAgICA9IHRoaXMuJHRhcmdldC5zY3JvbGxUb3AoKQogICAgdmFyIHBvc2l0\naW9uICAgICA9IHRoaXMuJGVsZW1lbnQub2Zmc2V0KCkKICAgIHZhciBvZmZzZXQgICAgICAgPSB0\naGlzLm9wdGlvbnMub2Zmc2V0CiAgICB2YXIgb2Zmc2V0VG9wICAgID0gb2Zmc2V0LnRvcAogICAg\ndmFyIG9mZnNldEJvdHRvbSA9IG9mZnNldC5ib3R0b20KCiAgICBpZiAodHlwZW9mIG9mZnNldCAh\nPSAnb2JqZWN0JykgICAgICAgICBvZmZzZXRCb3R0b20gPSBvZmZzZXRUb3AgPSBvZmZzZXQKICAg\nIGlmICh0eXBlb2Ygb2Zmc2V0VG9wID09ICdmdW5jdGlvbicpICAgIG9mZnNldFRvcCAgICA9IG9m\nZnNldC50b3AodGhpcy4kZWxlbWVudCkKICAgIGlmICh0eXBlb2Ygb2Zmc2V0Qm90dG9tID09ICdm\ndW5jdGlvbicpIG9mZnNldEJvdHRvbSA9IG9mZnNldC5ib3R0b20odGhpcy4kZWxlbWVudCkKCiAg\nICB2YXIgYWZmaXggPSB0aGlzLnVucGluICAgIT0gbnVsbCAmJiAoc2Nyb2xsVG9wICsgdGhpcy51\nbnBpbiA8PSBwb3NpdGlvbi50b3ApID8gZmFsc2UgOgogICAgICAgICAgICAgICAgb2Zmc2V0Qm90\ndG9tICE9IG51bGwgJiYgKHBvc2l0aW9uLnRvcCArIHRoaXMuJGVsZW1lbnQuaGVpZ2h0KCkgPj0g\nc2Nyb2xsSGVpZ2h0IC0gb2Zmc2V0Qm90dG9tKSA/ICdib3R0b20nIDoKICAgICAgICAgICAgICAg\nIG9mZnNldFRvcCAgICAhPSBudWxsICYmIChzY3JvbGxUb3AgPD0gb2Zmc2V0VG9wKSA/ICd0b3An\nIDogZmFsc2UKCiAgICBpZiAodGhpcy5hZmZpeGVkID09PSBhZmZpeCkgcmV0dXJuCiAgICBpZiAo\ndGhpcy51bnBpbiAhPSBudWxsKSB0aGlzLiRlbGVtZW50LmNzcygndG9wJywgJycpCgogICAgdmFy\nIGFmZml4VHlwZSA9ICdhZmZpeCcgKyAoYWZmaXggPyAnLScgKyBhZmZpeCA6ICcnKQogICAgdmFy\nIGUgICAgICAgICA9ICQuRXZlbnQoYWZmaXhUeXBlICsgJy5icy5hZmZpeCcpCgogICAgdGhpcy4k\nZWxlbWVudC50cmlnZ2VyKGUpCgogICAgaWYgKGUuaXNEZWZhdWx0UHJldmVudGVkKCkpIHJldHVy\nbgoKICAgIHRoaXMuYWZmaXhlZCA9IGFmZml4CiAgICB0aGlzLnVucGluID0gYWZmaXggPT0gJ2Jv\ndHRvbScgPyB0aGlzLmdldFBpbm5lZE9mZnNldCgpIDogbnVsbAoKICAgIHRoaXMuJGVsZW1lbnQK\nICAgICAgLnJlbW92ZUNsYXNzKEFmZml4LlJFU0VUKQogICAgICAuYWRkQ2xhc3MoYWZmaXhUeXBl\nKQogICAgICAudHJpZ2dlcigkLkV2ZW50KGFmZml4VHlwZS5yZXBsYWNlKCdhZmZpeCcsICdhZmZp\neGVkJykpKQoKICAgIGlmIChhZmZpeCA9PSAnYm90dG9tJykgewogICAgICB0aGlzLiRlbGVtZW50\nLm9mZnNldCh7CiAgICAgICAgdG9wOiBzY3JvbGxIZWlnaHQgLSB0aGlzLiRlbGVtZW50LmhlaWdo\ndCgpIC0gb2Zmc2V0Qm90dG9tCiAgICAgIH0pCiAgICB9CiAgfQoKCiAgLy8gQUZGSVggUExVR0lO\nIERFRklOSVRJT04KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PQoKICBmdW5jdGlvbiBQbHVn\naW4ob3B0aW9uKSB7CiAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgdmFy\nICR0aGlzICAgPSAkKHRoaXMpCiAgICAgIHZhciBkYXRhICAgID0gJHRoaXMuZGF0YSgnYnMuYWZm\naXgnKQogICAgICB2YXIgb3B0aW9ucyA9IHR5cGVvZiBvcHRpb24gPT0gJ29iamVjdCcgJiYgb3B0\naW9uCgogICAgICBpZiAoIWRhdGEpICR0aGlzLmRhdGEoJ2JzLmFmZml4JywgKGRhdGEgPSBuZXcg\nQWZmaXgodGhpcywgb3B0aW9ucykpKQogICAgICBpZiAodHlwZW9mIG9wdGlvbiA9PSAnc3RyaW5n\nJykgZGF0YVtvcHRpb25dKCkKICAgIH0pCiAgfQoKICB2YXIgb2xkID0gJC5mbi5hZmZpeAoKICAk\nLmZuLmFmZml4ICAgICAgICAgICAgID0gUGx1Z2luCiAgJC5mbi5hZmZpeC5Db25zdHJ1Y3RvciA9\nIEFmZml4CgoKICAvLyBBRkZJWCBOTyBDT05GTElDVAogIC8vID09PT09PT09PT09PT09PT09Cgog\nICQuZm4uYWZmaXgubm9Db25mbGljdCA9IGZ1bmN0aW9uICgpIHsKICAgICQuZm4uYWZmaXggPSBv\nbGQKICAgIHJldHVybiB0aGlzCiAgfQoKCiAgLy8gQUZGSVggREFUQS1BUEkKICAvLyA9PT09PT09\nPT09PT09PQoKICAkKHdpbmRvdykub24oJ2xvYWQnLCBmdW5jdGlvbiAoKSB7CiAgICAkKCdbZGF0\nYS1zcHk9ImFmZml4Il0nKS5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgdmFyICRzcHkgPSAkKHRo\naXMpCiAgICAgIHZhciBkYXRhID0gJHNweS5kYXRhKCkKCiAgICAgIGRhdGEub2Zmc2V0ID0gZGF0\nYS5vZmZzZXQgfHwge30KCiAgICAgIGlmIChkYXRhLm9mZnNldEJvdHRvbSkgZGF0YS5vZmZzZXQu\nYm90dG9tID0gZGF0YS5vZmZzZXRCb3R0b20KICAgICAgaWYgKGRhdGEub2Zmc2V0VG9wKSAgICBk\nYXRhLm9mZnNldC50b3AgICAgPSBkYXRhLm9mZnNldFRvcAoKICAgICAgUGx1Z2luLmNhbGwoJHNw\neSwgZGF0YSkKICAgIH0pCiAgfSkKCn0oalF1ZXJ5KTsK\n"
}