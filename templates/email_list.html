{% extends "base.html" %}

{% block content %}
  {% if detail %}
    <div class="alert alert-info">
      {{ detail }}
    </div>
  {% endif %}
  <div class="btn-group">
    {% if previous %}
      <a class="btn" href="{{ previous }}">Previous Page</a>
    {% endif %}
    {% if next %}
      <a class="btn" href="{{ next }}">Next Page</a>
    {% endif %}
  </div>


  {% if form.non_field_errors %}
    {% for error in form.non_field_errors %}
      <div class="alert alert-danger" role="alert">
        {{ error }}
      </div>
    {% endfor %}
  {% endif %}

  {% if form.json.errors %}
    <div class="alert alert-danger" role="alert">
      {% for error in form.json.errors %}
        {{ error }}
      {% endfor %}
    </div>
  {% endif %}


  <form id="" action='' method=POST>
    {% for field in form %}
      <div class="fieldWrapper">
        {{ field }}
        {% if field.help_text %}
          <p class="help">{{ field.help_text|safe }}</p>
        {% endif %}
      </div>
    {% endfor %}
    {% csrf_token %}
    <button class="m-4 btn btn-primary btn-lg" id='submit'>Create Inbox</button>
  </form>


  <table class="table table-hover">
    <thead>
      <tr>
        <th>Address</th>
        <th>Callback URL</th>
        <th>Inbox size</th>
        <th>Messages</th>
        <th></th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for r in results %}
        <tr>
          <td>
            <a target="bank" href="mailto:{{ r.address }}">{{ r.address }}</a>
          </td>
          <td>
            {{ r.callback_url | default:"None" }} 
          </td>
          <td>
            {{ r.messege_length_sum |filesizeformat }}
          </td>
          <td>
            <a href="{{ r.messages }}" class="btn btn-secondary btn-sm" > Message{{ r.message_count|pluralize }} <span class="badge badge-light">{{ r.message_count }}</span></a>
          </td>
          <td>
            <a href="{{ r.url }}" class="btn btn-outline-secondary btn-sm" >Edit</a>
          </td>
          <td>
            <form id="" action="{{ r.url }}" method="POST">
              <input type="submit" value="Delete" class="btn btn-outline-danger btn-sm">
              <input type="hidden" name="delete" value="1">
              {% csrf_token %}
            </form>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
  {% if not results %}
    <div class="alert alert-block alert-info">
      <h4>No inboxes yet</h4>
      Go ahead and create an inbox :D
    </div>
  {% endif %}
{% endblock %}

